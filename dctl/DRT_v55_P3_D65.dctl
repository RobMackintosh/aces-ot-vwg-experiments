DEFINE_UI_PARAMS(toneCurve, Tone Curve, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(compressChroma, Compress Chroma, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(gamutCompress, Gamut Compress, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(d60Sim, D60 Sim, DCTLUI_CHECK_BOX, 0)
DEFINE_UI_PARAMS(asPQ, Encode as PQ P3-D65 48nits, DCTLUI_CHECK_BOX, 0)
DEFINE_UI_PARAMS(ap1Clip, AP1 Clamp, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(softClip, Soft Clip, DCTLUI_CHECK_BOX, 0)
DEFINE_UI_PARAMS(hardClip, Clamp, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(invert, Invert, DCTLUI_CHECK_BOX, 0)
DEFINE_UI_PARAMS(JMhOut, Diagnostic JMh Output, DCTLUI_CHECK_BOX, 0)


typedef struct
{
    float3 x;
    float3 y;
    float3 z;
} float3x3;

// Constant values generated in Python
// https://github.com/nick-shaw/aces-ot-vwg-experiments/blob/master/python/v55_init_plot.py

__CONSTANT__ float3x3 XYZ_to_RGB_output =
{
// XYZ to P3-D65 matrix
    { 2.4934969119f, -0.9313836179f, -0.4027107845f },
    {-0.8294889696f,  1.7626640603f,  0.0236246858f },
    { 0.0358458302f, -0.0761723893f,  0.9568845240f }
};

__CONSTANT__ float3x3 RGB_to_XYZ_output =
{
// P3-D65 to XYZ matrix
    { 0.4865709486f,  0.2656676932f,  0.1982172852f },
    { 0.2289745641f,  0.6917385218f,  0.0792869141f },
    {-0.0000000000f,  0.0451133819f,  1.0439443689f }
};

__CONSTANT__ float3x3 RGB_to_XYZ_P3D60 =
{
    { 0.5049495342f,  0.2646814889f,  0.1830150515f },
    { 0.2376233102f,  0.6891706692f,  0.0732060206f },
    {-0.0000000000f,  0.0449459132f,  0.9638792711f }
};

__CONSTANT__ float limitJmax = 100.0f;
__CONSTANT__ float midJ = 34.0965348204f; // ~10 nits in Hellwig J
__CONSTANT__ float focusDist = 1.35f;

__CONSTANT__ float daniele_n = 100.0f; // peak white
__CONSTANT__ float daniele_m_2 = 1.0471037624f;
__CONSTANT__ float daniele_s_2 = 0.9198582542f;
__CONSTANT__ float daniele_u_2 = 0.9917990155f;  

// Chroma compression scaling for HDR/SDR appearance match
__CONSTANT__ float sat = 1.3f;
__CONSTANT__ float sat_thr = 0.005f;
__CONSTANT__ float compr = 2.4f;

__CONSTANT__ float3 gamutCuspTable[360] = 
{
    { 56.7406674138f,  81.7130544280f,  0.8405346718f },
    { 56.4378785319f,  82.2593830941f,  1.7229223773f },
    { 56.1320895086f,  82.8228799434f,  2.6346974566f },
    { 55.8231415456f,  83.4043005143f,  3.5796685544f },
    { 55.5108526378f,  84.0045203261f,  4.5624509956f },
    { 55.1950113557f,  84.6245772944f,  5.5887090535f },
    { 54.8753681560f,  85.2657349527f,  6.6654979178f },
    { 54.5516228797f,  85.9295794369f,  7.8017598843f },
    { 54.2234061502f,  86.6181733409f,  9.0090681676f },
    { 53.8902505510f,  87.3343097252f,  10.3027864149f },
    { 53.5515437189f,  88.0819523638f,  11.7039650170f },
    { 53.2064471712f,  88.8670466571f,  13.2426348596f },
    { 52.8537442481f,  89.6991359242f,  14.9639930309f },
    { 52.4915230717f,  90.5949472697f,  16.9413174419f },
    { 52.1164050159f,  91.5876862670f,  19.3073994450f },
    { 51.7211350533f,  92.7580587347f,  22.3525918527f },
    { 51.2819511632f,  94.4100990879f,  27.0369789561f },
    { 52.2771435372f,  90.8761778864f,  28.4593417497f },
    { 53.2436833633f,  87.6521763472f,  29.9081191719f },
    { 54.1842888966f,  84.7030975326f,  31.3815855417f },
    { 55.1012376890f,  82.0000150742f,  32.8781010765f },
    { 55.9964638314f,  79.5187166280f,  34.3960122554f },
    { 56.8716288595f,  77.2387031906f,  35.9335961527f },
    { 57.7281746145f,  75.1424373584f,  37.4890304960f },
    { 58.5673634136f,  73.2147694686f,  39.0603798292f },
    { 59.3903090918f,  71.4424933155f,  40.6455924450f },
    { 60.1980013491f,  69.8139979311f,  42.2425049568f },
    { 60.9913251005f,  68.3189917379f,  43.8488525495f },
    { 61.7710760380f,  66.9482820433f,  45.4622835640f },
    { 62.5379732825f,  65.6935974227f,  47.0803774002f },
    { 63.2926697696f,  64.5474437589f,  48.7006648905f },
    { 64.0357608514f,  63.5029869827f,  50.3206503833f },
    { 64.7677914800f,  62.5539572045f,  51.9378348234f },
    { 65.4892622511f,  61.6945701252f,  53.5497391518f },
    { 66.2006345235f,  60.9194624970f,  55.1539273847f },
    { 66.9023347851f,  60.2236390670f,  56.7480287785f },
    { 67.5947583969f,  59.6024289329f,  58.3297585516f },
    { 68.2782728224f,  59.0514496287f,  59.8969367069f },
    { 68.9532204274f,  58.5665775507f,  61.4475045891f },
    { 69.6199209193f,  58.1439235796f,  62.9795389045f },
    { 70.2786734805f,  57.7798129383f,  64.4912630303f },
    { 70.9297586448f,  57.4707684878f,  65.9810555387f },
    { 71.5734399521f,  57.2134967932f,  67.4474559500f },
    { 72.2099654137f,  57.0048764012f,  68.8891678122f },
    { 72.8395688149f,  56.8419478689f,  70.3050592729f },
    { 73.4624708769f,  56.7219051615f,  71.6941613650f },
    { 74.0788802956f,  56.6420881078f,  73.0556642642f },
    { 74.6889946738f,  56.5999756646f,  74.3889118054f },
    { 75.2930013604f,  56.5931797889f,  75.6933945543f },
    { 75.8910782068f,  56.6194397629f,  76.9687417286f },
    { 76.4833942521f,  56.6766168536f,  78.2147122563f },
    { 77.0701103433f,  56.7626892171f,  79.4311852357f },
    { 77.6513796997f,  56.8757469850f,  80.6181500418f },
    { 78.2273484270f,  57.0139874887f,  81.7756962915f },
    { 78.7981559860f,  57.1757105935f,  82.9040038550f },
    { 79.3639356217f,  57.3593141263f,  84.0033330668f },
    { 79.9248147567f,  57.5632893903f,  85.0740152627f },
    { 80.4809153520f,  57.7862167657f,  86.1164437409f },
    { 81.0323542390f,  58.0267613998f,  87.1310652204f },
    { 81.5792434254f,  58.2836689935f,  88.1183718473f },
    { 82.1216903774f,  58.5557616916f,  89.0788937808f },
    { 82.6597982805f,  58.8419340852f,  90.0131923732f },
    { 83.1936662812f,  59.1411493343f,  90.9218539452f },
    { 83.7233897105f,  59.4524354173f,  91.8054841469f },
    { 84.2490602921f,  59.7748815143f,  92.6647028860f },
    { 84.7707663350f,  60.1076345290f,  93.5001397978f },
    { 85.2885929137f,  60.4498957522f,  94.3124302282f },
    { 85.8026220355f,  60.8009176695f,  95.1022116968f },
    { 86.3129327966f,  61.1600009143f,  95.8701208048f },
    { 86.8196015286f,  61.5264913667f,  96.6167905547f },
    { 87.3227019343f,  61.8997773947f,  97.3428480443f },
    { 87.8223052161f,  62.2792872388f,  98.0489125028f },
    { 88.3184801953f,  62.6644865342f,  98.7355936355f },
    { 88.8112934249f,  63.0548759689f,  99.4034902447f },
    { 89.3008092944f,  63.4499890728f,  100.0531890992f },
    { 89.7870901298f,  63.8493901334f,  100.6852640239f },
    { 90.2701962860f,  64.2526722328f,  101.3002751835f },
    { 90.0542873311f,  64.2298806748f,  101.9073668499f },
    { 89.8376890169f,  64.2145539391f,  102.5182051712f },
    { 89.6203947985f,  64.2068230384f,  103.1326865796f },
    { 89.4023980252f,  64.2068190457f,  103.7507029856f },
    { 89.1836919374f,  64.2146730092f,  104.3721418328f },
    { 88.9642696647f,  64.2305158669f,  104.9968861660f },
    { 88.7441242228f,  64.2544783602f,  105.6248147121f },
    { 88.5232485111f,  64.2866909492f,  106.2558019738f },
    { 88.3016353101f,  64.3272837278f,  106.8897183373f },
    { 88.0792772782f,  64.3763863396f,  107.5264301918f },
    { 87.8561669489f,  64.4341278956f,  108.1658000628f },
    { 87.6322967278f,  64.5006368936f,  108.8076867585f },
    { 87.4076588897f,  64.5760411398f,  109.4519455279f },
    { 87.1822455752f,  64.6604676720f,  110.0984282321f },
    { 86.9560487871f,  64.7540426870f,  110.7469835273f },
    { 86.7290603877f,  64.8568914700f,  111.3974570588f },
    { 86.5012720945f,  64.9691383283f,  112.0496916668f },
    { 86.2726754773f,  65.0909065291f,  112.7035276017f },
    { 86.0432619538f,  65.2223182408f,  113.3588027500f },
    { 85.8130227860f,  65.3634944799f,  114.0153528681f },
    { 85.5819490762f,  65.5145550626f,  114.6730118251f },
    { 85.3500317630f,  65.6756185614f,  115.3316118529f },
    { 85.1172616167f,  65.8468022683f,  115.9909838018f },
    { 84.8836292350f,  66.0282221631f,  116.6509574028f },
    { 84.6491250386f,  66.2199928881f,  117.3113615334f },
    { 84.4137392661f,  66.4222277303f,  117.9720244871f },
    { 84.1774619694f,  66.6350386089f,  118.6327742457f },
    { 83.9402830087f,  66.8585360710f,  119.2934387524f },
    { 83.7021920468f,  67.0928292936f,  119.9538461856f },
    { 83.4631785442f,  67.3380260941f,  120.6138252313f },
    { 83.2232317530f,  67.5942329468f,  121.2732053540f },
    { 82.9823407115f,  67.8615550084f,  121.9318170652f },
    { 82.7404942376f,  68.1400961505f,  122.5894921867f },
    { 82.4976809233f,  68.4299590000f,  123.2460641098f },
    { 82.2538891275f,  68.7312449873f,  123.9013680486f },
    { 82.0091069695f,  69.0440544028f,  124.5552412856f },
    { 81.7633223222f,  69.3684864605f,  125.2075234109f },
    { 81.5165228045f,  69.7046393701f,  125.8580565514f },
    { 81.2686957740f,  70.0526104169f,  126.5066855917f },
    { 81.0198283191f,  70.4124960487f,  127.1532583844f },
    { 80.7699072509f,  70.7843919711f,  127.7976259503f },
    { 80.5189190947f,  71.1683932506f,  128.4396426667f },
    { 80.2668500812f,  71.5645944240f,  129.0791664448f },
    { 80.0136861374f,  71.9730896166f,  129.7160588941f },
    { 79.7594128771f,  72.3939726667f,  130.3501854752f },
    { 79.5040155912f,  72.8273372573f,  130.9814156391f },
    { 79.2474792369f,  73.2732770554f,  131.6096229548f },
    { 78.9897884275f,  73.7318858579f,  132.2346852223f },
    { 78.7309274210f,  74.2032577434f,  132.8564845740f },
    { 78.4708801085f,  74.6874872324f,  133.4749075622f },
    { 78.2096300021f,  75.1846694522f,  134.0898452341f },
    { 77.9471602221f,  75.6949003096f,  134.7011931940f },
    { 77.6834534840f,  76.2182766692f,  135.3088516526f },
    { 77.4184920848f,  76.7548965382f,  135.9127254648f },
    { 77.1522578882f,  77.3048592574f,  136.5127241546f },
    { 76.8847323099f,  77.8682656985f,  137.1087619292f },
    { 76.6158963022f,  78.4452184677f,  137.7007576817f },
    { 76.3457303367f,  79.0358221150f,  138.2886349829f },
    { 76.0742143879f,  79.6401833502f,  138.8723220627f },
    { 75.8013279153f,  80.2584112656f,  139.4517517830f },
    { 76.0360258507f,  77.5056453432f,  140.6124337324f },
    { 76.2650294882f,  75.0880661060f,  141.7270673444f },
    { 76.4895451574f,  72.9292899934f,  142.8084556950f },
    { 76.7103814828f,  70.9781743853f,  143.8650608289f },
    { 76.9281113199f,  69.1985424897f,  144.9027683655f },
    { 77.1431578656f,  67.5637182888f,  145.9258258625f },
    { 77.3558442224f,  66.0533800585f,  146.9373827661f },
    { 77.5664237244f,  64.6516346618f,  147.9398206150f },
    { 77.7750994164f,  63.3457802145f,  148.9349650353f },
    { 77.9820370738f,  62.1254788356f,  149.9242273846f },
    { 78.1873741959f,  60.9821849649f,  150.9087026143f },
    { 78.3912263966f,  59.9087390786f,  151.8892388522f },
    { 78.5936920533f,  58.8990719353f,  152.8664881337f },
    { 78.7948557625f,  57.9479847521f,  153.8409442218f },
    { 78.9947909536f,  57.0509828147f,  154.8129713765f },
    { 79.1935618996f,  56.2041474889f,  155.7828266498f },
    { 79.3912252851f,  55.4040363558f,  156.7506774626f },
    { 79.5878314454f,  54.6476042889f,  157.7166156908f },
    { 79.7834253578f,  53.9321403617f,  158.6806691304f },
    { 79.9780474410f,  53.2552168866f,  159.6428109667f },
    { 80.1717342086f,  52.6146478655f,  160.6029677077f },
    { 80.3645188058f,  52.0084548238f,  161.5610259207f },
    { 80.5564314547f,  51.4348385000f,  162.5168380239f },
    { 80.7474998267f,  50.8921552189f,  163.4702273261f },
    { 80.9377493554f,  50.3788970496f,  164.4209924589f },
    { 81.1272035020f,  49.8936750416f,  165.3689113128f },
    { 81.3158839805f,  49.4352049872f,  166.3137445622f },
    { 81.5038109516f,  49.0022952697f,  167.2552388456f },
    { 81.6910031887f,  48.5938364457f,  168.1931296514f },
    { 81.8774782220f,  48.2087922769f,  169.1271439495f },
    { 82.0632524637f,  47.8461919820f,  170.0570025982f },
    { 82.2483413165f,  47.5051235196f,  170.9824225511f },
    { 82.4327592700f,  47.1847277452f,  171.9031188820f },
    { 82.6165199839f,  46.8841933168f,  172.8188066434f },
    { 82.7996363631f,  46.6027522389f,  173.7292025685f },
    { 82.9821206224f,  46.3396759564f,  174.6340266268f },
    { 83.1639843457f,  46.0942719229f,  175.5330034417f },
    { 83.3452385374f,  45.8658805788f,  176.4258635745f },
    { 83.5258936694f,  45.6538726847f,  177.3123446817f },
    { 83.7059597220f,  45.4576469648f,  178.1921925504f },
    { 83.8854462224f,  45.2766280178f,  179.0651620155f },
    { 84.0643622772f,  45.1102644643f,  179.9310177644f },
    { 84.2427166040f,  44.9580272980f,  180.7895350323f },
    { 84.4205175580f,  44.8194084173f,  181.6405001936f },
    { 84.5977731576f,  44.6939193129f,  182.4837112537f },
    { 84.7744911071f,  44.5810898943f,  183.3189782449f },
    { 84.9506788171f,  44.4804674356f,  184.1461235338f },
    { 85.1263434235f,  44.3916156284f,  184.9649820413f },
    { 85.3014918051f,  44.3141137268f,  185.7754013852f },
    { 85.4761305991f,  44.2475557735f,  186.5772419457f },
    { 85.6502662157f,  44.1915498986f,  187.3703768632f },
    { 85.8239048515f,  44.1457176796f,  188.1546919718f },
    { 85.9970525020f,  44.1096935577f,  188.9300856737f },
    { 86.1697149727f,  44.0831243015f,  189.6964687610f },
    { 86.3418978896f,  44.0656685135f,  190.4537641898f },
    { 86.5136067090f,  44.0569961738f,  191.2019068113f },
    { 86.6848467265f,  44.0567882162f,  191.9408430651f },
    { 86.8556230854f,  44.0647361330f,  192.6705306409f },
    { 87.0259407842f,  44.0805416055f,  193.3909381108f },
    { 87.1958046841f,  44.1039161561f,  194.1020445395f },
    { 86.6896166836f,  43.8426692698f,  194.8159441017f },
    { 86.1798520965f,  43.5865234280f,  195.5443913978f },
    { 85.6664394260f,  43.3357494099f,  196.2876247411f },
    { 85.1493047819f,  43.0906290523f,  197.0458743105f },
    { 84.6283717677f,  42.8514555433f,  197.8193607223f },
    { 84.1035613604f,  42.6185337064f,  198.6082935034f },
    { 83.5747917825f,  42.3921802708f,  199.4128694642f },
    { 83.0419783664f,  42.1727241266f,  200.2332709736f },
    { 82.5050334096f,  41.9605065621f,  201.0696641372f },
    { 81.9638660211f,  41.7558814794f,  201.9221968849f },
    { 81.4183819568f,  41.5592155875f,  202.7909969716f },
    { 80.8684834448f,  41.3708885686f,  203.6761699008f },
    { 80.3140689981f,  41.1912932151f,  204.5777967804f },
    { 79.7550332147f,  41.0208355358f,  205.4959321226f },
    { 79.1912665635f,  40.8599348274f,  206.4306016041f },
    { 78.6226551550f,  40.7090237110f,  207.3817998039f },
    { 78.0490804958f,  40.5685481303f,  208.3494879379f },
    { 77.4704192242f,  40.4389673109f,  209.3335916147f },
    { 76.8865428265f,  40.3207536810f,  210.3339986384f },
    { 76.2973173323f,  40.2143927523f,  211.3505568852f },
    { 75.7026029847f,  40.1203829627f,  212.3830722870f },
    { 75.1022538865f,  40.0392354840f,  213.4313069529f },
    { 74.4961176161f,  39.9714739954f,  214.4949774634f },
    { 73.8840348138f,  39.9176344303f,  215.5737533752f },
    { 73.2658387323f,  39.8782647004f,  216.6672559694f },
    { 72.6413547504f,  39.8539244056f,  217.7750572824f },
    { 72.0103998441f,  39.8451845391f,  218.8966794530f },
    { 71.3727820110f,  39.8526272000f,  220.0315944196f },
    { 70.7282996438f,  39.8768453246f,  221.1792239966f },
    { 70.0767408462f,  39.9184424547f,  222.3389403586f },
    { 69.4178826849f,  39.9780325588f,  223.5100669509f },
    { 68.7514903702f,  40.0562399268f,  224.6918798439f },
    { 68.0773163574f,  40.1536991609f,  225.8836095382f },
    { 67.3950993582f,  40.2710552877f,  227.0844432218f },
    { 66.7045632517f,  40.4089640184f,  228.2935274701f },
    { 66.0054158828f,  40.5680921871f,  229.5099713724f },
    { 65.2973477312f,  40.7491184016f,  230.7328500579f },
    { 64.5800304369f,  40.9527339392f,  231.9612085842f },
    { 63.8531151593f,  41.1796439298f,  233.1940661438f },
    { 63.1162307498f,  41.4305688664f,  234.4304205322f },
    { 62.3689817085f,  41.7062464901f,  235.6692528155f },
    { 61.6109458944f,  42.0074341013f,  236.9095321255f },
    { 60.8416719522f,  42.3349113528f,  238.1502205041f },
    { 60.0606764101f,  42.6894835903f,  239.3902777129f },
    { 59.2674403975f,  43.0719858117f,  240.6286659178f },
    { 58.4614059189f,  43.4832873283f,  241.8643541544f },
    { 57.6419716085f,  43.9242972272f,  243.0963224738f },
    { 56.8084878746f,  44.3959707460f,  244.3235656655f },
    { 55.9602513234f,  44.8993166991f,  245.5450964459f },
    { 55.0964983263f,  45.4354061186f,  246.7599479936f },
    { 54.2163975653f,  46.0053823099f,  247.9671756997f },
    { 53.3190413506f,  46.6104725695f,  249.1658579850f },
    { 52.4034354530f,  47.2520018696f,  250.3550960056f },
    { 51.4684871312f,  47.9314088942f,  251.5340120357f },
    { 50.5129909435f,  48.6502649081f,  252.7017462529f },
    { 49.5356118226f,  49.4102960791f,  253.8574515739f },
    { 48.5348647419f,  50.2134100435f,  255.0002860652f },
    { 47.5090900908f,  51.0617277476f,  256.1294022796f },
    { 46.4564236029f,  51.9576219174f,  257.2439326117f },
    { 45.3747592862f,  52.9037639531f,  258.3429693838f },
    { 45.8870947346f,  52.0654123666f,  260.4100458176f },
    { 46.3913631287f,  51.3115047404f,  262.4831942449f },
    { 46.8879401679f,  50.6387089920f,  264.5584698105f },
    { 47.3771728964f,  50.0437689814f,  266.6318314744f },
    { 47.8593826784f,  49.5234855991f,  268.6991996350f },
    { 48.3348677879f,  49.0747034643f,  270.7565143065f },
    { 48.8039056727f,  48.6943025769f,  272.7997920105f },
    { 49.2667549403f,  48.3791942526f,  274.8251796074f },
    { 49.7236571075f,  48.1263206671f,  276.8290034590f },
    { 50.1748381463f,  47.9326573331f,  278.8078125787f },
    { 50.6205098545f,  47.7952178459f,  280.7584147522f },
    { 51.0608710749f,  47.7110602639f,  282.6779049832f },
    { 51.4961087829f,  47.6772945342f,  284.5636859902f },
    { 51.9263990593f,  47.6910904330f,  286.4134808382f },
    { 52.3519079627f,  47.7496855626f,  288.2253380990f },
    { 52.7727923149f,  47.8503930216f,  289.9976301872f },
    { 53.1892004076f,  47.9906084486f,  291.7290457042f },
    { 53.6012726421f,  48.1678162153f,  293.4185767358f },
    { 54.0091421076f,  48.3795946215f,  295.0655021038f },
    { 54.4129351071f,  48.6236200071f,  296.6693675594f },
    { 54.8127716348f,  48.8976697562f,  298.2299638629f },
    { 55.2087658111f,  49.1996242109f,  299.7473036006f },
    { 55.6010262806f,  49.5274675525f,  301.2215974910f },
    { 55.9896565749f,  49.8792877297f,  302.6532308094f },
    { 56.3747554456f,  50.2532755335f,  304.0427404434f },
    { 56.7564171699f,  50.6477229266f,  305.3907929744f },
    { 57.1347318316f,  51.0610207408f,  306.6981640746f },
    { 57.5097855790f,  51.4916558501f,  307.9657194155f },
    { 57.8816608637f,  51.9382079278f,  309.1943972019f },
    { 58.2504366604f,  52.3993458834f,  310.3851923808f },
    { 58.6161886703f,  52.8738240685f,  311.5391425193f },
    { 58.9789895097f,  53.3604783310f,  312.6573153078f },
    { 59.3389088843f,  53.8582219838f,  313.7407976106f },
    { 59.6960137512f,  54.3660417481f,  314.7906859708f },
    { 60.0503684697f,  54.8829937199f,  315.8080784576f },
    { 60.4020349415f,  55.4081993971f,  316.7940677429f },
    { 60.7510727409f,  55.9408418028f,  317.7497352876f },
    { 61.0975392367f,  56.4801617260f,  318.6761465226f },
    { 61.4414897059f,  57.0254541008f,  319.5743469133f },
    { 61.7829774396f,  57.5760645365f,  320.4453588010f },
    { 62.1220538425f,  58.1313860074f,  321.2901789253f },
    { 62.4587685262f,  58.6908557073f,  322.1097765353f },
    { 62.7931693956f,  59.2539520721f,  322.9050920102f },
    { 63.1253027314f,  59.8201919679f,  323.6770359134f },
    { 63.4552132666f,  60.3891280442f,  324.4264884165f },
    { 63.7829442585f,  60.9603462472f,  325.1542990342f },
    { 64.1085375569f,  61.5334634886f,  325.8612866180f },
    { 64.4320336678f,  62.1081254637f,  326.5482395655f },
    { 64.7534718135f,  62.6840046126f,  327.2159162049f },
    { 65.0728899896f,  63.2607982173f,  327.8650453220f },
    { 65.3903250185f,  63.8382266282f,  328.4963267996f },
    { 65.7058125996f,  64.4160316120f,  329.1104323448f },
    { 66.0193873577f,  64.9939748147f,  329.7080062835f },
    { 66.3310828879f,  65.5718363324f,  330.2896664035f },
    { 66.6409317982f,  66.1494133834f,  330.8560048307f },
    { 66.9489657501f,  66.7265190742f,  331.4075889269f },
    { 67.2552154974f,  67.3029812546f,  331.9449621973f },
    { 67.5597109219f,  67.8786414544f,  332.4686451999f },
    { 67.8624810684f,  68.4533538977f,  332.9791364494f },
    { 68.1635541773f,  69.0269845875f,  333.4769133091f },
    { 67.9333407434f,  69.1428714638f,  333.9694637022f },
    { 67.7020825153f,  69.2644320714f,  334.4662176223f },
    { 67.4697639382f,  69.3917926385f,  334.9672221551f },
    { 67.2363690157f,  69.5250823168f,  335.4725270086f },
    { 67.0018812902f,  69.6644332683f,  335.9821847820f },
    { 66.7662838214f,  69.8099807577f,  336.4962512612f },
    { 66.5295591644f,  69.9618632485f,  337.0147857426f },
    { 66.2916893457f,  70.1202225046f,  337.5378513904f },
    { 66.0526558373f,  70.2852036965f,  338.0655156278f },
    { 65.8124395297f,  70.4569555143f,  338.5978505692f },
    { 65.5710207028f,  70.6356302858f,  339.1349334961f },
    { 65.3283789940f,  70.8213841022f,  339.6768473818f },
    { 65.0844933653f,  71.0143769503f,  340.2236814719f },
    { 64.8393420662f,  71.2147728533f,  340.7755319255f },
    { 64.5929025952f,  71.4227400199f,  341.3325025267f },
    { 64.3451516574f,  71.6384510027f,  341.8947054732f },
    { 64.0960651189f,  71.8620828675f,  342.4622622538f },
    { 63.8456179572f,  72.0938173738f,  343.0353046247f },
    { 63.5937842075f,  72.3338411677f,  343.6139756999f },
    { 63.3405369040f,  72.5823459892f,  344.1984311699f },
    { 63.0858480163f,  72.8395288956f,  344.7888406681f },
    { 62.8296883789f,  73.1055925023f,  345.3853893050f },
    { 62.5720276149f,  73.3807452432f,  345.9882793976f },
    { 62.3128340513f,  73.6652016549f,  346.5977324215f },
    { 62.0520746258f,  73.9591826867f,  347.2139912224f },
    { 61.7897147834f,  74.2629160403f,  347.8373225293f },
    { 61.5257183620f,  74.5766365451f,  348.4680198184f },
    { 61.2600474639f,  74.9005865746f,  349.1064065897f },
    { 60.9926623135f,  75.2350165114f,  349.7528401282f },
    { 60.7235210953f,  75.5801852698f,  350.4077158400f },
    { 60.4525797728f,  75.9363608885f,  351.0714722698f },
    { 60.1797918823f,  76.3038212078f,  351.7445969351f },
    { 59.9051082976f,  76.6828546502f,  352.4276331407f },
    { 59.6284769604f,  77.0737611294f,  353.1211879795f },
    { 59.3498425700f,  77.4768531197f,  353.8259417765f },
    { 59.0691462223f,  77.8924569270f,  354.5426593031f },
    { 58.7863249884f,  78.3209142184f,  355.2722031750f },
    { 58.5013114190f,  78.7625838837f,  356.0155499692f },
    { 58.2140329558f,  79.2178443298f,  356.7738097535f },
    { 57.9244112273f,  79.6870963465f,  357.5482499399f },
    { 57.6323611984f,  80.1707667332f,  358.3403246701f },
    { 57.3377901317f,  80.6693129549f,  359.1517113617f },
    { 57.0405963059f,  81.1832292054f,  359.9843566327f }
};

__CONSTANT__ float gamutCuspTableReach[360] = 
{
    162.274f,
    164.783f,
    167.267f,
    169.727f,
    172.144f,
    174.506f,
    176.813f,
    179.041f,
    181.189f,
    183.246f,
    185.199f,
    187.054f,
    188.800f,
    190.442f,
    191.968f,
    193.390f,
    194.708f,
    195.923f,
    197.046f,
    198.071f,
    199.023f,
    199.896f,
    200.702f,
    201.447f,
    202.148f,
    194.867f,
    187.598f,
    180.914f,
    174.738f,
    169.025f,
    163.727f,
    158.795f,
    154.199f,
    149.908f,
    145.898f,
    142.133f,
    138.605f,
    135.284f,
    132.159f,
    129.218f,
    126.440f,
    123.816f,
    121.338f,
    118.988f,
    116.766f,
    114.661f,
    112.659f,
    110.767f,
    108.966f,
    107.251f,
    105.627f,
    104.077f,
    102.606f,
    101.208f,
    99.878f,
    98.608f,
    97.406f,
    96.259f,
    95.166f,
    94.122f,
    93.134f,
    92.194f,
    91.302f,
    90.454f,
    89.642f,
    88.879f,
    88.153f,
    87.463f,
    86.816f,
    86.200f,
    85.620f,
    85.071f,
    84.558f,
    84.076f,
    83.624f,
    83.197f,
    82.806f,
    82.446f,
    82.111f,
    81.799f,
    81.519f,
    81.262f,
    81.036f,
    80.835f,
    80.658f,
    80.505f,
    80.377f,
    80.273f,
    80.200f,
    80.145f,
    80.121f,
    80.115f,
    80.133f,
    80.182f,
    80.249f,
    80.347f,
    80.463f,
    80.609f,
    80.780f,
    80.975f,
    81.195f,
    81.439f,
    81.714f,
    82.013f,
    82.343f,
    82.697f,
    83.081f,
    83.496f,
    83.936f,
    84.412f,
    84.912f,
    85.449f,
    86.023f,
    86.627f,
    87.268f,
    87.946f,
    88.660f,
    89.410f,
    90.204f,
    91.040f,
    91.925f,
    92.847f,
    93.823f,
    94.849f,
    95.923f,
    97.052f,
    98.242f,
    99.487f,
    100.800f,
    102.179f,
    103.625f,
    105.151f,
    106.750f,
    108.435f,
    110.205f,
    112.073f,
    114.038f,
    116.107f,
    118.292f,
    120.599f,
    123.035f,
    125.616f,
    128.339f,
    131.226f,
    134.290f,
    135.352f,
    131.775f,
    128.436f,
    125.305f,
    122.363f,
    119.598f,
    116.992f,
    114.539f,
    112.225f,
    110.040f,
    107.971f,
    106.018f,
    104.169f,
    102.411f,
    100.751f,
    99.170f,
    97.675f,
    96.252f,
    94.904f,
    93.622f,
    92.407f,
    91.248f,
    90.149f,
    89.099f,
    88.110f,
    87.164f,
    86.267f,
    85.419f,
    84.607f,
    83.844f,
    83.118f,
    82.434f,
    81.781f,
    81.171f,
    80.591f,
    80.042f,
    79.529f,
    79.047f,
    78.595f,
    78.174f,
    77.783f,
    77.417f,
    77.081f,
    76.770f,
    76.489f,
    76.233f,
    76.001f,
    75.793f,
    75.616f,
    75.458f,
    75.330f,
    75.220f,
    75.134f,
    75.079f,
    75.043f,
    75.031f,
    75.043f,
    75.079f,
    75.134f,
    75.220f,
    75.330f,
    75.458f,
    75.616f,
    75.793f,
    76.001f,
    76.233f,
    76.489f,
    76.776f,
    77.081f,
    77.423f,
    77.789f,
    78.180f,
    78.607f,
    79.059f,
    79.541f,
    80.060f,
    80.609f,
    81.189f,
    81.812f,
    82.465f,
    83.154f,
    83.887f,
    84.662f,
    85.474f,
    86.334f,
    87.244f,
    88.196f,
    89.203f,
    90.265f,
    91.382f,
    92.560f,
    93.799f,
    95.105f,
    96.484f,
    97.937f,
    99.469f,
    101.086f,
    102.795f,
    104.608f,
    106.519f,
    108.545f,
    110.687f,
    112.970f,
    115.393f,
    117.969f,
    119.446f,
    117.694f,
    116.022f,
    114.429f,
    112.903f,
    111.450f,
    110.065f,
    108.740f,
    107.477f,
    106.268f,
    105.115f,
    104.016f,
    102.966f,
    101.965f,
    101.013f,
    100.104f,
    99.237f,
    98.413f,
    97.626f,
    96.881f,
    96.173f,
    95.502f,
    94.867f,
    94.269f,
    93.701f,
    93.164f,
    92.657f,
    92.188f,
    91.748f,
    91.333f,
    90.948f,
    90.594f,
    90.265f,
    89.966f,
    89.691f,
    89.447f,
    89.221f,
    89.032f,
    88.861f,
    88.715f,
    88.599f,
    88.501f,
    88.434f,
    88.391f,
    88.367f,
    88.373f,
    88.403f,
    88.458f,
    88.531f,
    88.635f,
    88.763f,
    88.916f,
    89.093f,
    89.294f,
    89.520f,
    89.771f,
    90.051f,
    90.356f,
    90.686f,
    91.046f,
    91.431f,
    91.840f,
    92.285f,
    92.755f,
    93.250f,
    93.781f,
    94.342f,
    94.928f,
    95.551f,
    96.210f,
    96.893f,
    97.620f,
    98.376f,
    99.170f,
    100.000f,
    100.867f,
    101.776f,
    102.722f,
    103.711f,
    104.736f,
    105.811f,
    106.927f,
    108.093f,
    109.308f,
    110.565f,
    111.871f,
    113.232f,
    114.648f,
    116.113f,
    117.633f,
    119.214f,
    120.844f,
    122.540f,
    124.292f,
    126.099f,
    127.972f,
    129.901f,
    131.891f,
    133.942f,
    136.053f,
    138.220f,
    140.442f,
    142.719f,
    145.050f,
    147.418f,
    149.829f,
    152.277f,
    154.755f,
    157.251f,
    159.760f
};

__CONSTANT__ float3 cGamutCuspTable[360] = 
{
    { 61.7659567473f,  108.0199429571f,  0.4498455949f },
    { 61.5258329766f,  108.6342655905f,  1.0432514535f },
    { 61.2836977682f,  109.2595313825f,  1.6517364179f },
    { 61.0394618297f,  109.8958997470f,  2.2769065013f },
    { 60.7930256564f,  110.5435321051f,  2.9206317400f },
    { 60.5442774572f,  111.2025932683f,  3.5851069768f },
    { 60.2930904674f,  111.8732538457f,  4.2729314381f },
    { 60.0393194055f,  112.5556943083f,  4.9872146270f },
    { 59.7827957123f,  113.2501117577f,  5.7317198745f },
    { 59.5233210094f,  113.9567311625f,  6.5110631075f },
    { 59.2606578825f,  114.6758241328f,  7.3309948938f },
    { 58.9945165089f,  115.4077407265f,  8.1988122743f },
    { 58.7245345699f,  116.1529645451f,  9.1239808519f },
    { 58.4502457968f,  116.9122111956f,  10.1191136868f },
    { 58.1710281433f,  117.6866118698f,  11.2015910887f },
    { 57.8860127315f,  118.4780757485f,  12.3964166096f },
    { 57.5939099413f,  119.2900635438f,  13.7416882994f },
    { 57.2926370266f,  120.1294316856f,  15.3003422612f },
    { 56.9783748380f,  121.0116274480f,  17.1899546689f },
    { 56.6424047727f,  121.9801370623f,  19.6827959358f },
    { 56.2508797599f,  123.2486945316f,  23.8458623392f },
    { 57.1258074835f,  118.9562503079f,  25.0750757343f },
    { 57.9763829415f,  114.9847081987f,  26.3234110479f },
    { 58.8049339041f,  111.3004412039f,  27.5913840881f },
    { 59.6134160687f,  107.8754838138f,  28.8792945415f },
    { 60.4034924316f,  104.6863076945f,  30.1872438856f },
    { 61.1765921026f,  101.7129124299f,  31.5151481771f },
    { 61.9339547124f,  98.9381374963f,  32.8627473789f },
    { 62.6766645024f,  96.3471329402f,  34.2296124691f },
    { 63.4056768823f,  93.9269460944f,  35.6151512756f },
    { 64.1218393947f,  91.6661946046f,  37.0186137683f },
    { 64.8259084627f,  89.5548046705f,  38.4390973791f },
    { 65.5185629137f,  87.5837992768f,  39.8755527987f },
    { 66.2004150073f,  85.7451252677f,  41.3267905933f },
    { 66.8720195097f,  84.0315109897f,  42.7914888988f },
    { 67.5338812216f,  82.4363482858f,  44.2682023672f },
    { 68.1864612710f,  80.9535941157f,  45.7553724641f },
    { 68.8301824114f,  79.5776881702f,  47.2513391443f },
    { 69.4654335097f,  78.3034836590f,  48.7543538615f },
    { 70.0925733733f,  77.1261890549f,  50.2625938055f },
    { 70.7119340302f,  76.0413190344f,  51.7741771982f },
    { 71.3238235560f,  75.0446531956f,  53.2871794307f },
    { 71.9285285223f,  74.1322013980f,  54.7996497800f },
    { 72.5263161268f,  73.3001747681f,  56.3096284137f },
    { 73.1174360557f,  72.5449615647f,  57.8151633719f },
    { 73.7021221162f,  71.8631072227f,  59.3143272091f },
    { 74.2805936764f,  71.2512979800f,  60.8052329891f },
    { 74.8530569370f,  70.7063475724f,  62.2860493411f },
    { 75.4197060603f,  70.2251865382f,  63.7550143203f },
    { 75.9807241746f,  69.8048537266f,  65.2104478514f },
    { 76.5362842713f,  69.4424896474f,  66.6507625834f },
    { 77.0865500084f,  69.1353313383f,  68.0744730321f },
    { 77.6316764316f,  68.8807084620f,  69.4802029372f },
    { 78.1718106240f,  68.6760403789f,  70.8666908153f },
    { 78.7070922926f,  68.5188339716f,  72.2327937334f },
    { 79.2376542992f,  68.4066820279f,  73.5774893718f },
    { 79.7636231411f,  68.3372620160f,  74.8998764811f },
    { 80.2851193896f,  68.3083351133f,  76.1991738672f },
    { 80.8022580882f,  68.3177453733f,  77.4747180585f },
    { 81.3151491166f,  68.3634189387f,  78.7259598243f },
    { 81.8238975241f,  68.4433632275f,  79.9524597203f },
    { 82.3286038340f,  68.5556660393f,  81.1538828387f },
    { 82.8293643244f,  68.6984945432f,  82.3299929340f },
    { 83.3262712855f,  68.8700941223f,  83.4806460885f },
    { 83.8194132571f,  69.0687870622f,  84.6057840692f },
    { 84.3088752475f,  69.2929710796f,  85.7054275125f },
    { 84.7947389360f,  69.5411176937f,  86.7796690575f },
    { 85.2770828599f,  69.8117704519f,  87.8286665333f },
    { 85.7559825887f,  70.1035430202f,  88.8526362869f },
    { 86.2315108845f,  70.4151171579f,  89.8518467253f },
    { 86.7037378524f,  70.7452405918f,  90.8266121276f },
    { 87.1727310795f,  71.0927248120f,  91.7772867713f },
    { 87.6385557648f,  71.4564428046f,  92.7042594032f },
    { 88.1012748404f,  71.8353267435f,  93.6079480757f },
    { 88.5609490846f,  72.2283656564f,  94.4887953586f },
    { 89.0176372275f,  72.6346030827f,  95.3472639297f },
    { 89.4713960504f,  73.0531347372f,  96.1838325410f },
    { 89.9222804781f,  73.4831061945f,  96.9989923509f },
    { 90.3703436661f,  73.9237106041f,  97.7932436101f },
    { 90.8156370826f,  74.3741864477f,  98.5670926852f },
    { 91.2582105849f,  74.8338153468f,  99.3210494018f },
    { 90.9944406784f,  74.8001484877f,  100.0659617848f },
    { 90.7296149522f,  74.7794700302f,  100.8163177985f },
    { 90.4637207658f,  74.7720492348f,  101.5719240561f },
    { 90.1967452207f,  74.7781550898f,  102.3325774192f },
    { 89.9286751533f,  74.7980560432f,  103.0980651847f },
    { 89.6594971267f,  74.8320197351f,  103.8681653126f },
    { 89.3891974230f,  74.8803127309f,  104.6426466962f },
    { 89.1177620347f,  74.9432002599f,  105.4212694751f },
    { 88.8451766564f,  75.0209459569f,  106.2037853897f },
    { 88.5714266757f,  75.1138116123f,  106.9899381775f },
    { 88.2964971635f,  75.2220569299f,  107.7794640101f },
    { 88.0203728649f,  75.3459392949f,  108.5720919692f },
    { 87.7430381886f,  75.4857135544f,  109.3675445596f },
    { 87.4644771968f,  75.6416318110f,  110.1655382588f },
    { 87.1846735940f,  75.8139432323f,  110.9657840985f },
    { 86.9036107156f,  76.0028938771f,  111.7679882773f },
    { 86.6212715165f,  76.2087265406f,  112.5718528001f },
    { 86.3376385583f,  76.4316806194f,  113.3770761423f },
    { 86.0526939965f,  76.6719919983f,  114.1833539337f },
    { 85.7664195676f,  76.9298929601f,  114.9903796598f },
    { 85.4787965746f,  77.2056121197f,  115.7978453756f },
    { 85.1898058725f,  77.4993743831f,  116.6054424282f },
    { 84.8994278536f,  77.8114009333f,  117.4128621840f },
    { 84.6076424310f,  78.1419092430f,  118.2197967564f },
    { 84.3144290224f,  78.4911131155f,  119.0259397292f },
    { 84.0197665328f,  78.8592227537f,  119.8309868727f },
    { 83.7236333363f,  79.2464448587f,  120.6346368469f },
    { 83.4260072570f,  79.6529827572f,  121.4365918891f },
    { 83.1268655497f,  80.0790365586f,  122.2365584815f },
    { 82.8261848788f,  80.5248033415f,  123.0342479956f },
    { 82.5239412967f,  80.9904773700f,  123.8293773097f },
    { 82.2201102209f,  81.4762503386f,  124.6216693964f },
    { 81.9146664105f,  81.9823116470f,  125.4108538778f },
    { 81.6075839411f,  82.5088487030f,  126.1966675461f },
    { 81.2988361785f,  83.0560472536f,  126.9788548464f },
    { 80.9883957512f,  83.6240917441f,  127.7571683216f },
    { 80.6762345214f,  84.2131657040f,  128.5313690164f },
    { 80.3623235549f,  84.8234521600f,  129.3012268413f },
    { 80.0466330891f,  85.4551340746f,  130.0665208933f },
    { 79.7291324990f,  86.1083948105f,  130.8270397364f },
    { 79.4097902624f,  86.7834186194f,  131.5825816383f },
    { 79.0885739223f,  87.4803911562f,  132.3329547669f },
    { 78.7654500476f,  88.1995000163f,  133.0779773450f },
    { 78.4403841921f,  88.9409352969f,  133.8174777652f },
    { 78.1133408503f,  89.7048901823f,  134.5512946661f },
    { 77.7842834116f,  90.4915615516f,  135.2792769706f },
    { 77.4531741115f,  91.3011506103f,  136.0012838890f },
    { 77.1199739800f,  92.1338635457f,  136.7171848878f },
    { 76.7846427873f,  92.9899122056f,  137.4268596264f },
    { 76.4471389857f,  93.8695148020f,  138.1301978639f },
    { 76.1074196488f,  94.7728966393f,  138.8270993379f },
    { 75.7654404065f,  95.7002908695f,  139.5174736185f },
    { 75.4211553763f,  96.6519392742f,  140.2012399375f },
    { 75.0745170900f,  97.6280930755f,  140.8783269982f },
    { 74.7254764164f,  98.6290137782f,  141.5486727653f },
    { 74.3739824783f,  99.6549740438f,  142.2122242390f },
    { 74.0199825649f,  100.7062586004f,  142.8689372146f },
    { 73.6634220380f,  101.7831651902f,  143.5187760301f },
    { 73.3042442318f,  102.8860055583f,  144.1617133043f },
    { 72.9423903469f,  104.0151064862f,  144.7977296662f },
    { 73.1737770306f,  100.2259992898f,  146.2885560169f },
    { 73.3926421235f,  97.1724522755f,  147.6153629898f },
    { 73.6032712109f,  94.5962069754f,  148.8363153220f },
    { 73.8079242210f,  92.3610745292f,  149.9820439294f },
    { 74.0079616899f,  90.3850653347f,  151.0709171676f },
    { 74.2042762442f,  88.6143896876f,  152.1149111470f },
    { 74.3974902015f,  87.0115511535f,  153.1223048868f },
    { 74.5880575650f,  85.5492003847f,  154.0990742007f },
    { 74.7763214344f,  84.2066751783f,  155.0496775267f },
    { 74.9625485244f,  82.9679198496f,  155.9775290285f },
    { 75.1469510294f,  81.8201671747f,  156.8852985796f },
    { 75.3297010681f,  80.7530674163f,  157.7751101464f },
    { 75.5109405667f,  79.7580923169f,  158.6486776336f },
    { 75.6907882230f,  78.8281150700f,  159.5074006776f },
    { 75.8693445377f,  77.9571067787f,  160.3524339149f },
    { 76.0466955301f,  77.1399122766f,  161.1847381702f },
    { 76.2229155346f,  76.3720813926f,  162.0051190077f },
    { 76.3980693400f,  75.6497398076f,  162.8142562544f },
    { 76.5722138526f,  74.9694887376f,  163.6127269482f },
    { 76.7453994037f,  74.3283259685f,  164.4010234118f },
    { 76.9176707923f,  73.7235829548f,  165.1795676573f },
    { 77.0890681243f,  73.1528741713f,  165.9487229898f },
    { 77.2596274951f,  72.6140559310f,  166.7088034446f },
    { 77.4293815494f,  72.1051925994f,  167.4600815287f },
    { 77.5983599447f,  71.6245286502f,  168.2027946216f },
    { 77.7665897375f,  71.1704653779f,  168.9371503049f },
    { 77.9340957076f,  70.7415413561f,  169.6633308281f },
    { 78.1009006317f,  70.3364159345f,  170.3814968720f },
    { 78.2670255168f,  69.9538552175f,  171.0917907358f },
    { 78.4324897990f,  69.5927200856f,  171.7943390492f },
    { 78.5973115143f,  69.2519559098f,  172.4892550892f },
    { 78.7615074468f,  68.9305836747f,  173.1766407651f },
    { 78.9250932561f,  68.6276922845f,  173.8565883259f },
    { 79.0880835899f,  68.3424318638f,  174.5291818307f },
    { 79.2504921805f,  68.0740079029f,  175.1944984194f },
    { 79.4123319317f,  67.8216761190f,  175.8526094107f },
    { 79.5736149934f,  67.5847379322f,  176.5035812532f },
    { 79.7343528290f,  67.3625364664f,  177.1474763487f },
    { 79.8945562745f,  67.1544530041f,  177.7843537663f },
    { 80.0542355914f,  66.9599038335f,  178.4142698601f },
    { 80.2134005136f,  66.7783374355f,  179.0372788036f },
    { 80.3720602898f,  66.6092319672f,  179.6534330516f },
    { 80.5302237212f,  66.4520930040f,  180.2627837384f },
    { 80.6878991957f,  66.3064515090f,  180.8653810201f },
    { 80.8450947184f,  66.1718620015f,  181.4612743676f },
    { 81.0018179396f,  66.0479009011f,  182.0505128167f },
    { 81.1580761799f,  65.9341650272f,  182.6331451798f },
    { 81.3138764530f,  65.8302702360f,  183.2092202247f },
    { 81.4692254865f,  65.7358501795f,  183.7787868233f },
    { 81.6241297409f,  65.6505551735f,  184.3418940745f },
    { 81.7785954272f,  65.5740511625f,  184.8985914044f },
    { 81.9326285222f,  65.5060187711f,  185.4489286458f },
    { 82.0862347833f,  65.4461524338f,  185.9929561006f },
    { 82.2394197622f,  65.3941595937f,  186.5307245860f },
    { 82.3921888166f,  65.3497599650f,  187.0622854679f },
    { 82.5445471217f,  65.3126848513f,  187.5876906814f },
    { 82.6964996810f,  65.2826765157f,  188.1069927416f },
    { 82.8480513355f,  65.2594875970f,  188.6202447452f },
    { 82.9992067728f,  65.2428805678f,  189.1275003646f },
    { 83.1499705353f,  65.2326272306f,  189.6288138348f },
    { 82.6552641854f,  64.7953381170f,  190.1327347012f },
    { 82.1569776446f,  64.3597566824f,  190.6477349489f },
    { 81.6550375270f,  63.9260508954f,  191.1741303355f },
    { 81.1493679274f,  63.4943982845f,  191.7122453020f },
    { 80.6398902983f,  63.0649864768f,  192.2624130054f },
    { 80.1265233208f,  62.6380137655f,  192.8249753185f },
    { 79.6091827653f,  62.2136897082f,  193.4002827930f },
    { 79.0877813444f,  61.7922357578f,  193.9886945795f },
    { 78.5622285560f,  61.3738859257f,  194.5905783000f },
    { 78.0324305151f,  60.9588874812f,  195.2063098657f },
    { 77.4982897753f,  60.5475016856f,  195.8362732332f },
    { 76.9597051370f,  60.1400045643f,  196.4808600924f },
    { 76.4165714427f,  59.7366877169f,  197.1404694778f },
    { 75.8687793577f,  59.3378591678f,  197.8155072946f },
    { 75.3162151346f,  58.9438442568f,  198.5063857501f },
    { 74.7587603612f,  58.5549865715f,  199.2135226810f },
    { 74.1962916886f,  58.1716489228f,  199.9373407670f },
    { 73.6286805398f,  57.7942143637f,  200.6782666181f },
    { 73.0557927947f,  57.4230872516f,  201.4367297261f },
    { 72.4774884508f,  57.0586943558f,  202.2131612679f },
    { 71.8936212576f,  56.7014860096f,  203.0079927494f },
    { 71.3040383195f,  56.3519373071f,  203.8216544773f },
    { 70.7085796675f,  56.0105493454f,  204.6545738485f },
    { 70.1070777935f,  55.6778505113f,  205.5071734446f },
    { 69.4993571455f,  55.3543978126f,  206.3798689230f },
    { 68.8852335779f,  55.0407782537f,  207.2730666928f },
    { 68.2645137529f,  54.7376102549f,  208.1871613698f },
    { 67.6369944872f,  54.4455451153f,  209.1225330043f },
    { 67.0024620379f,  54.1652685194f,  210.0795440780f },
    { 66.3606913206f,  53.8975020877f,  211.0585362704f },
    { 65.7114450519f,  53.6430049717f,  212.0598269985f },
    { 65.0544728058f,  53.4025754967f,  213.0837057384f },
    { 64.3895099756f,  53.1770528543f,  214.1304301409f },
    { 63.7162766273f,  52.9673188501f,  215.2002219628f },
    { 63.0344762315f,  52.7742997144f,  216.2932628386f },
    { 62.3437942575f,  52.5989679857f,  217.4096899264f },
    { 61.6438966103f,  52.4423444824f,  218.5495914705f },
    { 60.9344278897f,  52.3055003801f,  219.7130023299f },
    { 60.2150094446f,  52.1895594229f,  220.8998995321f },
    { 59.4852371940f,  52.0957002990f,  222.1101979186f },
    { 58.7446791777f,  52.0251592256f,  223.3437459601f },
    { 57.9928727967f,  51.9792327961f,  224.6003218227f },
    { 57.2293216921f,  51.9592811584f,  225.8796297766f },
    { 56.4534922040f,  51.9667316105f,  227.1812970421f },
    { 55.6648093388f,  52.0030827191f,  228.5048711707f },
    { 54.8626521593f,  52.0699090945f,  229.8498180584f },
    { 54.0463484928f,  52.1688669839f,  231.2155206851f },
    { 53.2151688310f,  52.3017008843f,  232.6012786666f },
    { 52.3683192640f,  52.4702514238f,  234.0063086905f },
    { 51.5049332561f,  52.6764648152f,  235.4297458907f },
    { 50.6240620227f,  52.9224042604f,  236.8706461891f },
    { 49.7246632057f,  53.2102637756f,  238.3279895968f },
    { 48.8055874662f,  53.5423850203f,  239.8006844272f },
    { 47.8655625047f,  53.9212778693f,  241.2875723131f },
    { 46.9031738817f,  54.3496456584f,  242.7874338512f },
    { 45.9168418183f,  54.8304163018f,  244.2989945966f },
    { 44.9047928978f,  55.3667808304f,  245.8209310046f },
    { 43.8650252293f,  55.9622413829f,  247.3518757333f },
    { 42.7952651285f,  56.6206713573f,  248.8904214568f },
    { 41.6929126477f,  57.3463913778f,  250.4351219483f },
    { 42.4088722861f,  55.6791623279f,  253.4692702535f },
    { 43.1068015758f,  54.2239249082f,  256.5502295332f },
    { 43.7880181863f,  52.9704797675f,  259.6656364138f },
    { 44.4536858858f,  51.9089882292f,  262.8017890532f },
    { 45.1048385499f,  51.0297540091f,  265.9440539464f },
    { 45.7423995698f,  50.3230773693f,  269.0773344822f },
    { 46.3671976916f,  49.7791744291f,  272.1865684892f },
    { 46.9799800559f,  49.3881531133f,  275.2572174740f },
    { 47.5814230191f,  49.1400356077f,  278.2757110920f },
    { 48.1721412003f,  49.0248158980f,  281.2298163954f },
    { 48.7526950958f,  49.0325404614f,  284.1089112112f },
    { 49.3235975290f,  49.1534006410f,  286.9041525993f },
    { 49.8853191460f,  49.3778266118f,  289.6085425596f },
    { 50.4382931231f,  49.6965748835f,  292.2169022777f },
    { 50.9829192216f,  50.1008036387f,  294.7257722416f },
    { 51.5195672939f,  50.5821325417f,  297.1332583256f },
    { 52.0485803329f,  51.1326857100f,  299.4388438616f },
    { 52.5702771316f,  51.7451181664f,  301.6431855843f },
    { 53.0849546143f,  52.4126272275f,  303.7479080154f },
    { 53.5928898872f,  53.1289509670f,  305.7554071107f },
    { 54.0943420475f,  53.8883561897f,  307.6686704081f },
    { 54.5895537863f,  54.6856183691f,  309.4911178115f },
    { 55.0787528124f,  55.5159958198f,  311.2264646975f },
    { 55.5621531209f,  56.3752000953f,  312.8786072423f },
    { 56.0399561271f,  57.2593642630f,  314.4515286736f },
    { 56.5123516824f,  58.1650103788f,  315.9492244410f },
    { 56.9795189874f,  59.0890171672f,  317.3756439649f },
    { 57.4416274139f,  60.0285886458f,  318.7346465421f },
    { 57.8988372473f,  60.9812242033f,  320.0299690812f },
    { 58.3513003581f,  61.9446904570f,  321.2652035357f },
    { 58.7991608110f,  62.9169950753f,  322.4437821467f },
    { 59.2425554185f,  63.8963626411f,  323.5689688681f },
    { 59.6816142448f,  64.8812125539f,  324.6438556007f },
    { 60.1164610654f,  65.8701389152f,  325.6713620967f },
    { 60.5472137875f,  66.8618923022f,  326.6542386056f },
    { 60.9739848346f,  67.8553633148f,  327.5950705109f },
    { 61.3968814991f,  68.8495677670f,  328.4962843629f },
    { 61.8160062668f,  69.8436333908f,  329.3601548399f },
    { 62.2314571147f,  70.8367879189f,  330.1888122729f },
    { 62.6433277860f,  71.8283484202f,  330.9842504574f },
    { 63.0517080436f,  72.8177117653f,  331.7483345423f },
    { 63.4566839042f,  73.8043461103f,  332.4828088406f },
    { 63.8583378557f,  74.7877832928f,  333.1893044513f },
    { 64.2567490574f,  75.7676120459f,  333.8693466118f },
    { 64.6519935267f,  76.7434719430f,  334.5243617319f },
    { 65.0441443126f,  77.7150479936f,  335.1556840738f },
    { 65.4332716561f,  78.6820658208f,  335.7645620631f },
    { 65.8194431406f,  79.6442873569f,  336.3521642246f },
    { 66.2027238315f,  80.6015069997f,  336.9195847447f },
    { 66.5831764067f,  81.5535481793f,  337.4678486696f },
    { 66.9608612783f,  82.5002602902f,  337.9979167516f },
    { 67.3358367068f,  83.4415159491f,  338.5106899585f },
    { 67.7081589074f,  84.3772085418f,  339.0070136649f },
    { 68.0778821502f,  85.3072500282f,  339.4876815407f },
    { 68.4450588537f,  86.2315689773f,  339.9534391582f },
    { 68.8097396731f,  87.1501088065f,  340.4049873337f },
    { 69.1719735824f,  88.0628262039f,  340.8429852228f },
    { 69.5318079526f,  88.9696897135f,  341.2680531866f },
    { 69.8892886246f,  89.8706784658f,  341.6807754444f },
    { 70.2444599782f,  90.7657810381f,  342.0817025293f },
    { 70.0523865328f,  91.0555435502f,  342.4771243840f },
    { 69.8595104850f,  91.3512328607f,  342.8745253084f },
    { 69.6658198254f,  91.6529372676f,  343.2739464532f },
    { 69.4713021913f,  91.9607466599f,  343.6754320761f },
    { 69.2759448499f,  92.2747525544f,  344.0790297765f },
    { 69.0797346811f,  92.5950481343f,  344.4847907493f },
    { 68.8826581583f,  92.9217282874f,  344.8927700619f },
    { 68.6847013288f,  93.2548896448f,  345.3030269553f },
    { 68.4858497916f,  93.5946306202f,  345.7156251736f },
    { 68.2860886750f,  93.9410514487f,  346.1306333233f },
    { 68.0854026112f,  94.2942542258f,  346.5481252677f },
    { 67.8837757102f,  94.6543429464f,  346.9681805590f },
    { 67.6811915305f,  95.0214235427f,  347.3908849134f },
    { 67.4776330483f,  95.3956039219f,  347.8163307347f },
    { 67.2730826240f,  95.7769940027f,  348.2446176916f },
    { 67.0675219657f,  96.1657057502f,  348.6758533565f },
    { 66.8609320894f,  96.5618532095f,  349.1101539131f },
    { 66.6532932764f,  96.9655525367f,  349.5476449430f },
    { 66.4445850259f,  97.3769220274f,  349.9884623009f },
    { 66.2347860040f,  97.7960821421f,  350.4327530916f },
    { 66.0238739871f,  98.2231555274f,  350.8806767634f },
    { 65.8118258002f,  98.6582670330f,  351.3324063350f },
    { 65.5986172484f,  99.1015437226f,  351.7881297759f },
    { 65.3842230416f,  99.5531148796f,  352.2480515638f },
    { 65.1686167105f,  100.0131120040f,  352.7123944484f },
    { 64.9517705139f,  100.4816688024f,  353.1814014537f },
    { 64.7336553339f,  100.9589211673f,  353.6553381602f },
    { 64.5142405594f,  101.4450071458f,  354.1344953153f },
    { 64.2934939550f,  101.9400668963f,  354.6191918296f },
    { 64.0713815117f,  102.4442426317f,  355.1097782311f },
    { 63.8478672783f,  102.9576785470f,  355.6066406637f },
    { 63.6229131689f,  103.4805207317f,  356.1102055380f },
    { 63.3964787413f,  104.0129170651f,  356.6209449646f },
    { 63.1685209423f,  104.5550170945f,  357.1393831371f },
    { 62.9389938111f,  105.1069718978f,  357.6661038709f },
    { 62.7078481335f,  105.6689339317f,  358.2017595600f },
    { 62.4750310347f,  106.2410568720f,  358.7470818872f },
    { 62.2404854973f,  106.8234954539f,  359.3028947182f },
    { 62.0041497848f,  107.4164053281f,  359.8701297419f }
};

__CONSTANT__ float cGamutReachTable[360] = 
{
    162.274f,
    164.783f,
    167.267f,
    169.727f,
    172.144f,
    174.506f,
    176.813f,
    179.041f,
    181.189f,
    183.246f,
    185.199f,
    187.054f,
    188.800f,
    190.442f,
    191.968f,
    193.390f,
    194.708f,
    195.923f,
    197.046f,
    198.071f,
    199.023f,
    199.896f,
    200.702f,
    201.447f,
    202.148f,
    194.867f,
    187.598f,
    180.914f,
    174.738f,
    169.025f,
    163.727f,
    158.795f,
    154.199f,
    149.908f,
    145.898f,
    142.133f,
    138.605f,
    135.284f,
    132.159f,
    129.218f,
    126.440f,
    123.816f,
    121.338f,
    118.988f,
    116.766f,
    114.661f,
    112.659f,
    110.767f,
    108.966f,
    107.251f,
    105.627f,
    104.077f,
    102.606f,
    101.208f,
    99.878f,
    98.608f,
    97.406f,
    96.259f,
    95.166f,
    94.122f,
    93.134f,
    92.194f,
    91.302f,
    90.454f,
    89.642f,
    88.879f,
    88.153f,
    87.463f,
    86.816f,
    86.200f,
    85.620f,
    85.071f,
    84.558f,
    84.076f,
    83.624f,
    83.197f,
    82.806f,
    82.446f,
    82.111f,
    81.799f,
    81.519f,
    81.262f,
    81.036f,
    80.835f,
    80.658f,
    80.505f,
    80.377f,
    80.273f,
    80.200f,
    80.145f,
    80.121f,
    80.115f,
    80.133f,
    80.182f,
    80.249f,
    80.347f,
    80.463f,
    80.609f,
    80.780f,
    80.975f,
    81.195f,
    81.439f,
    81.714f,
    82.013f,
    82.343f,
    82.697f,
    83.081f,
    83.496f,
    83.936f,
    84.412f,
    84.912f,
    85.449f,
    86.023f,
    86.627f,
    87.268f,
    87.946f,
    88.660f,
    89.410f,
    90.204f,
    91.040f,
    91.925f,
    92.847f,
    93.823f,
    94.849f,
    95.923f,
    97.052f,
    98.242f,
    99.487f,
    100.800f,
    102.179f,
    103.625f,
    105.151f,
    106.750f,
    108.435f,
    110.205f,
    112.073f,
    114.038f,
    116.107f,
    118.292f,
    120.599f,
    123.035f,
    125.616f,
    128.339f,
    131.226f,
    134.290f,
    135.352f,
    131.775f,
    128.436f,
    125.305f,
    122.363f,
    119.598f,
    116.992f,
    114.539f,
    112.225f,
    110.040f,
    107.971f,
    106.018f,
    104.169f,
    102.411f,
    100.751f,
    99.170f,
    97.675f,
    96.252f,
    94.904f,
    93.622f,
    92.407f,
    91.248f,
    90.149f,
    89.099f,
    88.110f,
    87.164f,
    86.267f,
    85.419f,
    84.607f,
    83.844f,
    83.118f,
    82.434f,
    81.781f,
    81.171f,
    80.591f,
    80.042f,
    79.529f,
    79.047f,
    78.595f,
    78.174f,
    77.783f,
    77.417f,
    77.081f,
    76.770f,
    76.489f,
    76.233f,
    76.001f,
    75.793f,
    75.616f,
    75.458f,
    75.330f,
    75.220f,
    75.134f,
    75.079f,
    75.043f,
    75.031f,
    75.043f,
    75.079f,
    75.134f,
    75.220f,
    75.330f,
    75.458f,
    75.616f,
    75.793f,
    76.001f,
    76.233f,
    76.489f,
    76.776f,
    77.081f,
    77.423f,
    77.789f,
    78.180f,
    78.607f,
    79.059f,
    79.541f,
    80.060f,
    80.609f,
    81.189f,
    81.812f,
    82.465f,
    83.154f,
    83.887f,
    84.662f,
    85.474f,
    86.334f,
    87.244f,
    88.196f,
    89.203f,
    90.265f,
    91.382f,
    92.560f,
    93.799f,
    95.105f,
    96.484f,
    97.937f,
    99.469f,
    101.086f,
    102.795f,
    104.608f,
    106.519f,
    108.545f,
    110.687f,
    112.970f,
    115.393f,
    117.969f,
    119.446f,
    117.694f,
    116.022f,
    114.429f,
    112.903f,
    111.450f,
    110.065f,
    108.740f,
    107.477f,
    106.268f,
    105.115f,
    104.016f,
    102.966f,
    101.965f,
    101.013f,
    100.104f,
    99.237f,
    98.413f,
    97.626f,
    96.881f,
    96.173f,
    95.502f,
    94.867f,
    94.269f,
    93.701f,
    93.164f,
    92.657f,
    92.188f,
    91.748f,
    91.333f,
    90.948f,
    90.594f,
    90.265f,
    89.966f,
    89.691f,
    89.447f,
    89.221f,
    89.032f,
    88.861f,
    88.715f,
    88.599f,
    88.501f,
    88.434f,
    88.391f,
    88.367f,
    88.373f,
    88.403f,
    88.458f,
    88.531f,
    88.635f,
    88.763f,
    88.916f,
    89.093f,
    89.294f,
    89.520f,
    89.771f,
    90.051f,
    90.356f,
    90.686f,
    91.046f,
    91.431f,
    91.840f,
    92.285f,
    92.755f,
    93.250f,
    93.781f,
    94.342f,
    94.928f,
    95.551f,
    96.210f,
    96.893f,
    97.620f,
    98.376f,
    99.170f,
    100.000f,
    100.867f,
    101.776f,
    102.722f,
    103.711f,
    104.736f,
    105.811f,
    106.927f,
    108.093f,
    109.308f,
    110.565f,
    111.871f,
    113.232f,
    114.648f,
    116.113f,
    117.633f,
    119.214f,
    120.844f,
    122.540f,
    124.292f,
    126.099f,
    127.972f,
    129.901f,
    131.891f,
    133.942f,
    136.053f,
    138.220f,
    140.442f,
    142.719f,
    145.050f,
    147.418f,
    149.829f,
    152.277f,
    154.755f,
    157.251f,
    159.760f
};

__CONSTANT__ float gamutTopGamma[360] = 
{
    0.889117431640625f,
    0.888079833984375f,
    0.887060546875000f,
    0.886071777343750f,
    0.885113525390625f,
    0.884179687500000f,
    0.883282470703125f,
    0.882421875000000f,
    0.881591796875000f,
    0.880810546875000f,
    0.880059814453125f,
    0.879351806640625f,
    0.878692626953125f,
    0.878076171875000f,
    0.877502441406250f,
    0.876977539062500f,
    0.876489257812500f,
    0.876055908203125f,
    0.875653076171875f,
    0.875311279296875f,
    0.874993896484375f,
    0.874725341796875f,
    0.874511718750000f,
    0.874304199218750f,
    0.874133300781250f,
    0.874017333984375f,
    0.873956298828125f,
    0.873950195312500f,
    0.876629638671875f,
    0.879321289062500f,
    0.881921386718750f,
    0.884301757812500f,
    0.886596679687500f,
    0.888830566406250f,
    0.890911865234375f,
    0.892919921875000f,
    0.894897460937500f,
    0.896734619140625f,
    0.898535156250000f,
    0.900311279296875f,
    0.901965332031250f,
    0.903607177734375f,
    0.905200195312500f,
    0.906726074218750f,
    0.908251953125000f,
    0.909698486328125f,
    0.911126708984375f,
    0.912548828125000f,
    0.913891601562500f,
    0.915240478515625f,
    0.916546630859375f,
    0.917828369140625f,
    0.919116210937500f,
    0.920336914062500f,
    0.921563720703125f,
    0.922778320312500f,
    0.923950195312500f,
    0.925140380859375f,
    0.926293945312500f,
    0.927429199218750f,
    0.928582763671875f,
    0.929693603515625f,
    0.930804443359375f,
    0.931927490234375f,
    0.933007812500000f,
    0.934094238281250f,
    0.935198974609375f,
    0.936260986328125f,
    0.937329101562500f,
    0.938415527343750f,
    0.939477539062500f,
    0.940533447265625f,
    0.941607666015625f,
    0.942681884765625f,
    0.943731689453125f,
    0.944799804687500f,
    0.945874023437500f,
    0.946960449218750f,
    0.948028564453125f,
    0.949102783203125f,
    0.950189208984375f,
    0.951281738281250f,
    0.952392578125000f,
    0.953509521484375f,
    0.954638671875000f,
    0.955767822265625f,
    0.956909179687500f,
    0.958062744140625f,
    0.959240722656250f,
    0.960430908203125f,
    0.961645507812500f,
    0.962866210937500f,
    0.964105224609375f,
    0.965368652343750f,
    0.956933593750000f,
    0.940832519531250f,
    0.924548339843750f,
    0.908001708984375f,
    0.891125488281250f,
    0.873724365234375f,
    0.855737304687500f,
    0.836889648437500f,
    0.833819580078125f,
    0.837548828125000f,
    0.841064453125000f,
    0.844390869140625f,
    0.847534179687500f,
    0.850512695312500f,
    0.853344726562500f,
    0.856042480468750f,
    0.858612060546875f,
    0.861059570312500f,
    0.863397216796875f,
    0.865637207031250f,
    0.867779541015625f,
    0.869830322265625f,
    0.871801757812500f,
    0.873687744140625f,
    0.875512695312500f,
    0.877258300781250f,
    0.878936767578125f,
    0.880560302734375f,
    0.882122802734375f,
    0.883624267578125f,
    0.885076904296875f,
    0.886474609375000f,
    0.887829589843750f,
    0.889135742187500f,
    0.890393066406250f,
    0.891613769531250f,
    0.892785644531250f,
    0.893920898437500f,
    0.895013427734375f,
    0.896075439453125f,
    0.897094726562500f,
    0.898077392578125f,
    0.899023437500000f,
    0.899932861328125f,
    0.900811767578125f,
    0.901654052734375f,
    0.903863525390625f,
    0.907202148437500f,
    0.910327148437500f,
    0.913244628906250f,
    0.915972900390625f,
    0.918536376953125f,
    0.920947265625000f,
    0.923217773437500f,
    0.925354003906250f,
    0.927368164062500f,
    0.929272460937500f,
    0.931072998046875f,
    0.932781982421875f,
    0.934393310546875f,
    0.935925292968750f,
    0.937377929687500f,
    0.938751220703125f,
    0.940051269531250f,
    0.941290283203125f,
    0.942462158203125f,
    0.943572998046875f,
    0.944622802734375f,
    0.945617675781250f,
    0.946563720703125f,
    0.947454833984375f,
    0.948291015625000f,
    0.949084472656250f,
    0.949829101562500f,
    0.950524902343750f,
    0.951177978515625f,
    0.951782226562500f,
    0.952343750000000f,
    0.952862548828125f,
    0.953332519531250f,
    0.953759765625000f,
    0.954144287109375f,
    0.954486083984375f,
    0.954785156250000f,
    0.955041503906250f,
    0.955255126953125f,
    0.955419921875000f,
    0.955529785156250f,
    0.955596923828125f,
    0.955615234375000f,
    0.955590820312500f,
    0.955505371093750f,
    0.955358886718750f,
    0.955157470703125f,
    0.954901123046875f,
    0.954577636718750f,
    0.954180908203125f,
    0.953717041015625f,
    0.953179931640625f,
    0.952551269531250f,
    0.951849365234375f,
    0.967822265625000f,
    0.969512939453125f,
    0.970404052734375f,
    0.971160888671875f,
    0.971826171875000f,
    0.972418212890625f,
    0.972943115234375f,
    0.973400878906250f,
    0.973803710937500f,
    0.974163818359375f,
    0.974481201171875f,
    0.974768066406250f,
    0.975024414062500f,
    0.975256347656250f,
    0.975457763671875f,
    0.975634765625000f,
    0.975793457031250f,
    0.975933837890625f,
    0.976055908203125f,
    0.976165771484375f,
    0.976257324218750f,
    0.976336669921875f,
    0.976409912109375f,
    0.976464843750000f,
    0.976513671875000f,
    0.976556396484375f,
    0.976574707031250f,
    0.976593017578125f,
    0.976599121093750f,
    0.976599121093750f,
    0.976593017578125f,
    0.976586914062500f,
    0.976568603515625f,
    0.976531982421875f,
    0.976495361328125f,
    0.976458740234375f,
    0.976409912109375f,
    0.976361083984375f,
    0.976300048828125f,
    0.976232910156250f,
    0.976159667968750f,
    0.976080322265625f,
    0.976000976562500f,
    0.975909423828125f,
    0.975811767578125f,
    0.975708007812500f,
    0.975598144531250f,
    0.975482177734375f,
    0.975360107421875f,
    0.975225830078125f,
    0.975085449218750f,
    0.974938964843750f,
    0.974786376953125f,
    0.974627685546875f,
    0.974450683593750f,
    0.974267578125000f,
    0.974072265625000f,
    0.973870849609375f,
    0.973657226562500f,
    0.973437500000000f,
    0.973199462890625f,
    0.972943115234375f,
    0.972668457031250f,
    0.972375488281250f,
    0.972265625000000f,
    0.972296142578125f,
    0.972314453125000f,
    0.972344970703125f,
    0.972369384765625f,
    0.972387695312500f,
    0.972412109375000f,
    0.972430419921875f,
    0.972454833984375f,
    0.972467041015625f,
    0.972497558593750f,
    0.972503662109375f,
    0.972534179687500f,
    0.972534179687500f,
    0.972570800781250f,
    0.972564697265625f,
    0.972601318359375f,
    0.972595214843750f,
    0.972625732421875f,
    0.972619628906250f,
    0.972650146484375f,
    0.972644042968750f,
    0.972674560546875f,
    0.972668457031250f,
    0.972686767578125f,
    0.972692871093750f,
    0.972705078125000f,
    0.972711181640625f,
    0.972717285156250f,
    0.972735595703125f,
    0.972729492187500f,
    0.972760009765625f,
    0.972741699218750f,
    0.972760009765625f,
    0.972760009765625f,
    0.972760009765625f,
    0.972778320312500f,
    0.972766113281250f,
    0.972772216796875f,
    0.972778320312500f,
    0.972772216796875f,
    0.972778320312500f,
    0.972778320312500f,
    0.972772216796875f,
    0.972772216796875f,
    0.972784423828125f,
    0.972766113281250f,
    0.972760009765625f,
    0.972760009765625f,
    0.972766113281250f,
    0.972747802734375f,
    0.972735595703125f,
    0.972723388671875f,
    0.972711181640625f,
    0.972705078125000f,
    0.972692871093750f,
    0.972674560546875f,
    0.972662353515625f,
    0.972637939453125f,
    0.972619628906250f,
    0.972595214843750f,
    0.972564697265625f,
    0.972540283203125f,
    0.972515869140625f,
    0.972479248046875f,
    0.972430419921875f,
    0.972393798828125f,
    0.972344970703125f,
    0.972290039062500f,
    0.972235107421875f,
    0.967700195312500f,
    0.956909179687500f,
    0.946246337890625f,
    0.935687255859375f,
    0.925189208984375f,
    0.919567871093750f,
    0.918347167968750f,
    0.917132568359375f,
    0.915924072265625f,
    0.914709472656250f,
    0.913500976562500f,
    0.912298583984375f,
    0.911096191406250f,
    0.909893798828125f,
    0.908697509765625f,
    0.907501220703125f,
    0.906304931640625f,
    0.905114746093750f,
    0.903924560546875f,
    0.902740478515625f,
    0.901556396484375f,
    0.900378417968750f,
    0.899206542968750f,
    0.898040771484375f,
    0.896887207031250f,
    0.895733642578125f,
    0.894598388671875f,
    0.893469238281250f,
    0.892358398437500f,
    0.891259765625000f,
    0.890179443359375f
};

#include "hellwig_lib_v055.h"

__DEVICE__ float3 transform(int p_Width, int p_Height, int p_X, int p_Y, float p_R, float p_G, float p_B)
{
    float3 in = make_float3(p_R, p_G, p_B);
    float3 out = in;

    float3 XYZ;

    if (!invert)
    {
        XYZ = vector_dot(AP0_ACES_to_XYZ_matrix, in);
        if (ap1Clip)
        {
            float3 AP1 = vector_dot(XYZ_to_AP1_ACES_matrix, XYZ);
            AP1.x = _fmaxf(AP1.x, 0.0f);
            AP1.y = _fmaxf(AP1.y, 0.0f);
            AP1.z = _fmaxf(AP1.z, 0.0f);
            XYZ = vector_dot(AP1_ACES_to_XYZ_matrix, AP1);
        }
    }
    else
    {
        in = float3spow(in, 2.6f);
        XYZ = vector_dot(RGB_to_XYZ_output, in);
    }
    XYZ *= referenceLuminance;
    float3 JMh;
    if (!invert)
    {
        JMh = XYZ_to_Hellwig2022_JMh(XYZ, inWhite);
        if (toneCurve)
        {
            JMh = forwardTonescale(JMh, compressChroma);
        }
        if (gamutCompress)
        {
            JMh = compressGamut(JMh, 0);
        }
    }
    else
    {
        JMh = XYZ_to_Hellwig2022_JMh(XYZ, d65White);
        if (gamutCompress)
        {
            JMh = compressGamut(JMh, 1);
        }
        if (toneCurve)
        {
            JMh = inverseTonescale(JMh, compressChroma);
        }
    }
    if (JMhOut)
    {
        out.x = JMh.x / referenceLuminance;
        out.y = JMh.y / referenceLuminance;
        out.z = JMh.z / 360.0f;
    }
    else
    {
        if (!invert)
        {
            if (!d60Sim)
            {
                XYZ = Hellwig2022_JMh_to_XYZ(JMh , d65White) / referenceLuminance;
            }
            else
            {
                XYZ = Hellwig2022_JMh_to_XYZ(JMh , inWhite) / referenceLuminance;
                float3 creativeWhiteXYZ = vector_dot(RGB_to_XYZ_P3D60, make_float3(1.0f, 1.0f, 1.0f));
                float3 creativeWhiteRGB = vector_dot(XYZ_to_RGB_output, creativeWhiteXYZ);
                XYZ *= 1.0f / max(creativeWhiteRGB.x, max(creativeWhiteRGB.y, creativeWhiteRGB.z));
            }
            out = vector_dot(XYZ_to_RGB_output, XYZ);

            // Soft clamp by compressing negative display linear values
            if (softClip)
            {
				float3 compr = make_float3(clamp_thr, clamp_dist, 1.2f);
				out = compress_aces(out, compr, compr, compr, 0);
            }

            // hard clip 0-1
            if (hardClip)
            {
				out = clamp3(out, 0.0f, 1.0f);
            }
            
            if (asPQ)
            {
                out *= 48.0f;
                out.x = linear_to_ST2084(out.x);
                out.y = linear_to_ST2084(out.y);
                out.z = linear_to_ST2084(out.z);
            }
            else
            {
                out = float3spow(out, 1.0f / 2.6f);
            }
        }
        else
        {
            XYZ = Hellwig2022_JMh_to_XYZ(JMh , inWhite) / referenceLuminance;
            out = vector_dot(XYZ_to_AP0_ACES_matrix, XYZ);
        }
    }

    return out;
}