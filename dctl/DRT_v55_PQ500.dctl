DEFINE_UI_PARAMS(toneCurve, Tone Curve, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(compressChroma, Compress Chroma, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(gamutCompress, Gamut Compress, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(d60Sim, D60 Sim, DCTLUI_CHECK_BOX, 0)
DEFINE_UI_PARAMS(asPQ, Encode as BT.2100 PQ, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(ap1Clip, AP1 Clamp, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(softClip, Soft Clip, DCTLUI_CHECK_BOX, 0)
DEFINE_UI_PARAMS(hardClip, Clamp, DCTLUI_CHECK_BOX, 1)
DEFINE_UI_PARAMS(invert, Invert, DCTLUI_CHECK_BOX, 0)
DEFINE_UI_PARAMS(JMhOut, Diagnostic JMh Output, DCTLUI_CHECK_BOX, 0)


typedef struct
{
    float3 x;
    float3 y;
    float3 z;
} float3x3;

// Constant values generated in Python
// https://github.com/nick-shaw/aces-ot-vwg-experiments/blob/master/python/v55_init_plot.py

__CONSTANT__ float3x3 XYZ_to_RGB_output =
{
// XYZ to P3-D65 matrix
    { 2.4934969119f, -0.9313836179f, -0.4027107845f },
    {-0.8294889696f,  1.7626640603f,  0.0236246858f },
    { 0.0358458302f, -0.0761723893f,  0.9568845240f }
};

__CONSTANT__ float3x3 RGB_to_XYZ_output =
{
// P3-D65 to XYZ matrix
    { 0.4865709486f,  0.2656676932f,  0.1982172852f },
    { 0.2289745641f,  0.6917385218f,  0.0792869141f },
    {-0.0000000000f,  0.0451133819f,  1.0439443689f }
};

__CONSTANT__ float3x3 RGB_to_XYZ_P3D60 =
{
    { 0.5049495342f,  0.2646814889f,  0.1830150515f },
    { 0.2376233102f,  0.6891706692f,  0.0732060206f },
    {-0.0000000000f,  0.0449459132f,  0.9638792711f }
};

__CONSTANT__ float3x3 P3D65_to_BT2020 =
{
    { 0.7538330344f,  0.1985973691f,  0.0475695966f },
    { 0.0457438490f,  0.9417772198f,  0.0124789312f },
    {-0.0012103404f,  0.0176017173f,  0.9836086231f }
};

__CONSTANT__ float limitJmax = 208.257070f;
__CONSTANT__ float midJ = 38.9322092937f; // ~13 nits in Hellwig J
__CONSTANT__ float focusDist = 3.0013166352f;

__CONSTANT__ float daniele_n = 500.0f; // peak white  
__CONSTANT__ float daniele_m_2 = 5.0892350790f;
__CONSTANT__ float daniele_s_2 = 3.3869123661f;
__CONSTANT__ float daniele_u_2 = 0.9902637512f;

// Chroma compression scaling for HDR/SDR appearance match
__CONSTANT__ float sat = 0.6730239061f;
__CONSTANT__ float sat_thr = 0.0010f;
__CONSTANT__ float compr = 7.935842f;

__CONSTANT__ float3 gamutCuspTable[360] = 
{
    { 119.7492720866f,  154.9681309956f,  0.8259675206f },
    { 119.1208857318f,  156.0316605376f,  1.7088922424f },
    { 118.4860983408f,  157.1277427722f,  2.6219139681f },
    { 117.8445705057f,  158.2578391382f,  3.5689451154f },
    { 117.1959131823f,  159.4236491898f,  4.5547264347f },
    { 116.5396743838f,  160.6271958227f,  5.5850759509f },
    { 115.8753205790f,  161.8709525292f,  6.6672403912f },
    { 115.2022099281f,  163.1580389297f,  7.8104051547f },
    { 114.5195524486f,  164.4925314178f,  9.0264588530f },
    { 113.8263482862f,  165.8799767248f,  10.3311852277f },
    { 113.1212872315f,  167.3282831390f,  11.7462125775f },
    { 112.4025747960f,  168.8493639999f,  13.3023999122f },
    { 111.6676063244f,  170.4624170351f,  15.0461963280f },
    { 110.9122873365f,  172.2012072813f,  17.0529181646f },
    { 110.1293790468f,  174.1329632126f,  19.4590629257f },
    { 109.3033291561f,  176.4215050905f,  22.5630995170f },
    { 108.3831626373f,  179.6854201490f,  27.3519019611f },
    { 110.4553285128f,  172.8751126525f,  28.7936793544f },
    { 112.4662566721f,  166.6681444385f,  30.2619113852f },
    { 114.4217691113f,  160.9960567086f,  31.7547590411f },
    { 116.3267432960f,  155.8022590455f,  33.2704704588f },
    { 118.1853206527f,  151.0393744853f,  34.8072797762f },
    { 120.0010585782f,  146.6672817304f,  36.3633511888f },
    { 121.7770437537f,  142.6516449599f,  37.9367494942f },
    { 123.5159782466f,  138.9627920085f,  39.5254272369f },
    { 125.2202460415f,  135.5748462909f,  41.1272229492f },
    { 126.8919652177f,  132.4650468366f,  42.7398672349f },
    { 128.5330294151f,  129.6132100357f,  44.3609946345f },
    { 130.1451411810f,  127.0012997304f,  45.9881598432f },
    { 131.7298390780f,  124.6130812589f,  47.6188571865f },
    { 133.2885199353f,  122.4338413479f,  49.2505424363f },
    { 134.8224572786f,  120.4501602146f,  50.8806561450f },
    { 136.3328167176f,  118.6497254541f,  52.5066477338f },
    { 137.8206688929f,  117.0211796329f,  54.1259996188f },
    { 139.2870004428f,  115.5539952432f,  55.7362507097f },
    { 140.7327233538f,  114.2383719642f,  57.3350186777f },
    { 142.1586829804f,  113.0651521642f,  58.9200204681f },
    { 143.5656649617f,  112.0257513295f,  60.4890906185f },
    { 144.9544012171f,  111.1121007013f,  62.0401970471f },
    { 146.3255751699f,  110.3165998716f,  63.5714540784f },
    { 147.6798263169f,  109.6320774705f,  65.0811325779f },
    { 149.0177542455f,  109.0517583932f,  66.5676671708f },
    { 150.3399221767f,  108.5692362728f,  68.0296606096f },
    { 151.6468601034f,  108.1784501319f,  69.4658854357f },
    { 152.9390675790f,  107.8736643294f,  70.8752831451f },
    { 154.2170162047f,  107.6494510827f,  72.2569611168f },
    { 155.4811518533f,  107.5006749807f,  73.6101875961f },
    { 156.7318966661f,  107.4224790235f,  74.9343850420f },
    { 157.9696508477f,  107.4102718194f,  76.2291221526f },
    { 159.1947942869f,  107.4597156579f,  77.4941048752f },
    { 160.4076880219f,  107.5667152427f,  78.7291666898f },
    { 161.6086755687f,  107.7274069279f,  79.9342584327f },
    { 162.7980841293f,  107.9381483449f,  81.1094378972f },
    { 163.9762256910f,  108.1955083447f,  82.2548594177f },
    { 165.1433980306f,  108.4962572078f,  83.3707636122f },
    { 166.2998856325f,  108.8373570950f,  84.4574674251f },
    { 167.4459605304f,  109.2159527272f,  85.5153545842f },
    { 168.5818830792f,  109.6293622956f,  86.5448665569f },
    { 169.7079026661f,  110.0750686066f,  87.5464940659f },
    { 170.8242583646f,  110.5507104737f,  88.5207692038f },
    { 171.9311795385f,  111.0540743677f,  89.4682581671f },
    { 173.0288864004f,  111.5830863386f,  90.3895546145f },
    { 174.1175905279f,  112.1358042206f,  91.2852736423f },
    { 175.1974953430f,  112.7104101298f,  92.1560463596f },
    { 176.2687965560f,  113.3052032632f,  93.0025150385f },
    { 177.3316825791f,  113.9185930036f,  93.8253288098f },
    { 178.3863349110f,  114.5490923340f,  94.6251398690f },
    { 179.4329284949f,  115.1953115608f,  95.4026001591f },
    { 180.4716320528f,  115.8559523461f,  96.1583584905f },
    { 181.5026083981f,  116.5298020428f,  96.8930580627f },
    { 182.5260147273f,  117.2157283297f,  97.6073343519f },
    { 183.5420028932f,  117.9126741373f,  98.3018133271f },
    { 184.5507196615f,  118.6196528569f,  98.9771099644f },
    { 185.5523069504f,  119.3357438248f,  99.6338270252f },
    { 186.5469020568f,  120.0600880691f,  100.2725540710f },
    { 187.5346378679f,  120.7918843107f,  100.8938666861f },
    { 188.5156430609f,  121.5303852067f,  101.4983258847f },
    { 188.0774838032f,  121.4941261612f,  102.0937001564f },
    { 187.6378643408f,  121.4714957592f,  102.6928116479f },
    { 187.1967707365f,  121.4627395559f,  103.2955646683f },
    { 186.7541888268f,  121.4681035919f,  103.9018591965f },
    { 186.3101042163f,  121.4878342472f,  104.5115909221f },
    { 185.8645022730f,  121.5221780944f,  105.1246512981f },
    { 185.4173681219f,  121.5713817509f,  105.7409276058f },
    { 184.9686866399f,  121.6356917318f,  106.3603030313f },
    { 184.5184424499f,  121.7153543026f,  106.9826567539f },
    { 184.0666199144f,  121.8106153333f,  107.6078640470f },
    { 183.6132031296f,  121.9217201545f,  108.2357963914f },
    { 183.1581759186f,  122.0489134157f,  108.8663215996f },
    { 182.7015218254f,  122.1924389462f,  109.4993039530f },
    { 182.2432241071f,  122.3525396208f,  110.1346043507f },
    { 181.7832657278f,  122.5294572282f,  110.7720804687f },
    { 181.3216293506f,  122.7234323464f,  111.4115869318f },
    { 180.8582973304f,  122.9347042216f,  112.0529754947f },
    { 180.3932517062f,  123.1635106554f,  112.6960952340f },
    { 179.9264741928f,  123.4100878978f,  113.3407927496f },
    { 179.4579461727f,  123.6746705480f,  113.9869123757f },
    { 178.9876486874f,  123.9574914639f,  114.6342963988f },
    { 178.5155624287f,  124.2587816802f,  115.2827852852f },
    { 178.0416677295f,  124.5787703360f,  115.9322179136f },
    { 177.5659445543f,  124.9176846125f,  116.5824318150f },
    { 177.0883724894f,  125.2757496813f,  117.2332634171f },
    { 176.6089307328f,  125.6531886641f,  117.8845482934f },
    { 176.1275980837f,  126.0502226032f,  118.5361214152f },
    { 175.6443529319f,  126.4670704453f,  119.1878174068f },
    { 175.1591732462f,  126.9039490367f,  119.8394708008f },
    { 174.6720365630f,  127.3610731316f,  120.4909162956f },
    { 174.1829199742f,  127.8386554142f,  121.1419890107f },
    { 173.6918001148f,  128.3369065337f,  121.7925247418f },
    { 173.1986531500f,  128.8560351528f,  122.4423602125f },
    { 172.7034547615f,  129.3962480109f,  123.0913333232f },
    { 172.2061801341f,  129.9577500009f,  123.7392833953f },
    { 171.7068039409f,  130.5407442600f,  124.3860514107f },
    { 171.2053003286f,  131.1454322760f,  125.0314802440f },
    { 170.7016429017f,  131.7720140062f,  125.6754148894f },
    { 170.1958047068f,  132.4206880126f,  126.3177026788f },
    { 169.6877582153f,  133.0916516099f,  126.9581934917f },
    { 169.1774753066f,  133.7851010291f,  127.5967399566f },
    { 168.6649272497f,  134.5012315945f,  128.2331976419f },
    { 168.1500846846f,  135.2402379154f,  128.8674252375f },
    { 167.6329176025f,  136.0023140916f,  129.4992847250f },
    { 167.1133953258f,  136.7876539332f,  130.1286415373f },
    { 166.5914864868f,  137.5964511938f,  130.7553647071f },
    { 166.0671590057f,  138.4288998177f,  131.3793270027f },
    { 165.5403800679f,  139.2851942003f,  132.0004050531f },
    { 165.0111160995f,  140.1655294623f,  132.6184794604f },
    { 164.4793327435f,  141.0701017367f,  133.2334349006f },
    { 163.9449948326f,  141.9991084690f,  133.8451602119f },
    { 163.4080663634f,  142.9527487306f,  134.4535484715f },
    { 162.8685104671f,  143.9312235448f,  135.0584970602f },
    { 162.3262893808f,  144.9347362258f,  135.6599077152f },
    { 161.7813644164f,  145.9634927302f,  136.2576865716f },
    { 161.2336959286f,  147.0177020219f,  136.8517441932f },
    { 160.6832432812f,  148.0975764488f,  137.4419955912f },
    { 160.1299648123f,  149.2033321335f,  138.0283602335f },
    { 159.5738177971f,  150.3351893762f,  138.6107620432f },
    { 159.0147584101f,  151.4933730709f,  139.1891293877f },
    { 159.4980178528f,  146.1626705356f,  140.3615518292f },
    { 159.9691232340f,  141.4869698222f,  141.4874248228f },
    { 160.4306546759f,  137.3165895480f,  142.5796757956f },
    { 160.8843410607f,  133.5513473389f,  143.6468449210f },
    { 161.3314067834f,  130.1204002873f,  144.6948684530f },
    { 161.7727560907f,  126.9715255513f,  145.7280270501f },
    { 162.2090791616f,  124.0649502669f,  146.7494914650f },
    { 162.6409169990f,  121.3695762317f,  147.7616562710f },
    { 163.0687031033f,  118.8605546802f,  148.7663541324f },
    { 163.4927913201f,  116.5176651915f,  149.7649989856f },
    { 163.9134750751f,  114.3241956473f,  150.7586849801f },
    { 164.3310010367f,  112.2661464017f,  151.7482568447f },
    { 164.7455790566f,  110.3316510734f,  152.7343612067f },
    { 165.1573895549f,  108.5105461292f,  153.7174848679f },
    { 165.5665891068f,  106.7940451549f,  154.6979839360f },
    { 165.9733147390f,  105.1744883547f,  155.6761064149f },
    { 166.3776872801f,  103.6451471340f,  156.6520100294f },
    { 166.7798140081f,  102.2000696949f,  157.6257765220f },
    { 167.1797907663f,  100.8339576299f,  158.5974233007f },
    { 167.5777036725f,  99.5420662664f,  159.5669130699f },
    { 167.9736305127f,  98.3201234341f,  160.5341619068f },
    { 168.3676418884f,  97.1642626861f,  161.4990461257f },
    { 168.7598021664f,  96.0709679761f,  162.4614081856f },
    { 169.1501702745f,  95.0370275029f,  163.4210618328f },
    { 169.5388003688f,  94.0594949560f,  164.3777966267f },
    { 169.9257423998f,  93.1356567846f,  165.3313819578f },
    { 170.3110425943f,  92.2630044042f,  166.2815706464f },
    { 170.6947438674f,  91.4392104827f,  167.2281021861f },
    { 171.0768861780f,  90.6621086138f,  168.1707056843f },
    { 171.4575068356f,  89.9296758252f,  169.1091025389f },
    { 171.8366407669f,  89.2400174669f,  170.0430088816f },
    { 172.2143207488f,  88.5913541132f,  170.9721378131f },
    { 172.5905776119f,  87.9820101723f,  171.8962014471f },
    { 172.9654404199f,  87.4104039528f,  172.8149127794f },
    { 173.3389366277f,  86.8750389769f,  173.7279873935f },
    { 173.7110922214f,  86.3744963644f,  174.6351450121f },
    { 174.0819318429f,  85.9074281397f,  175.5361109024f },
    { 174.4514789005f,  85.4725513371f,  176.4306171424f },
    { 174.8197556682f,  85.0686427962f,  177.3184037540f },
    { 175.1867833740f,  84.6945345589f,  178.1992197084f },
    { 175.5525822803f,  84.3491097881f,  179.0728238083f },
    { 175.9171717553f,  84.0312991418f,  179.9389854534f },
    { 176.2805703380f,  83.7400775456f,  180.7974852929f },
    { 176.6427957969f,  83.4744613117f,  181.6481157707f },
    { 177.0038651834f,  83.2335055627f,  182.4906815684f },
    { 177.3637948802f,  83.0163019216f,  183.3249999510f },
    { 177.7226006451f,  82.8219764347f,  184.1509010219f },
    { 178.0802976518f,  82.6496876999f,  184.9682278913f },
    { 178.4369005262f,  82.4986251737f,  185.7768367647f },
    { 178.7924233804f,  82.3680076362f,  186.5765969573f },
    { 179.1468798438f,  82.2570817936f,  187.3673908391f },
    { 179.5002830914f,  82.1651210033f,  188.1491137179f },
    { 179.8526458696f,  82.0914241039f,  188.9216736648f },
    { 180.2039805214f,  82.0353143406f,  189.6849912886f },
    { 180.5542990077f,  81.9961383713f,  190.4389994644f },
    { 180.9036129285f,  81.9732653462f,  191.1836430218f },
    { 181.2519335419f,  81.9660860509f,  191.9188783980f },
    { 181.5992717820f,  81.9740121050f,  192.6446732610f },
    { 181.9456382751f,  81.9964752117f,  193.3610061074f },
    { 182.2910433554f,  82.0329264495f,  194.0678658394f },
    { 181.2611230984f,  81.5702904403f,  194.7775266938f },
    { 180.2236147558f,  81.1169368928f,  195.5014786651f },
    { 179.1783658066f,  80.6733632455f,  196.2399533052f },
    { 178.1252186138f,  80.2400873822f,  196.9931743289f },
    { 177.0640101820f,  79.8176481967f,  197.7613562543f },
    { 175.9945719000f,  79.4066061424f,  198.5447029495f },
    { 174.9167292672f,  79.0075437601f,  199.3434060840f },
    { 173.8303016030f,  78.6210661839f,  200.1576434891f },
    { 172.7351017375f,  78.2478016162f,  200.9875774262f },
    { 171.6309356815f,  77.8884017709f,  201.8333527698f },
    { 170.5176022754f,  77.5435422782f,  202.6950951085f },
    { 169.3948928138f,  77.2139230473f,  203.5729087724f },
    { 168.2625906458f,  76.9002685816f,  204.4668747965f },
    { 167.1204707458f,  76.6033282437f,  205.3770488307f },
    { 165.9682992560f,  76.3238764643f,  206.3034590104f },
    { 164.8058329947f,  76.0627128934f,  207.2461038047f },
    { 163.6328189306f,  75.8206624900f,  208.2049498597f },
    { 162.4489936168f,  75.5985755485f,  209.1799298596f },
    { 161.2540825834f,  75.3973276618f,  210.1709404276f },
    { 160.0477996838f,  75.2178196205f,  211.1778400945f },
    { 158.8298463898f,  75.0609772515f,  212.2004473625f },
    { 157.5999110320f,  74.9277511985f,  213.2385388943f },
    { 156.3576679787f,  74.8191166514f,  214.2918478606f },
    { 155.1027767480f,  74.7360730331f,  215.3600624780f },
    { 153.8348810463f,  74.6796436531f,  216.4428247723f },
    { 152.5536077250f,  74.6508753438f,  217.5397295995f },
    { 151.2585656477f,  74.6508380947f,  218.6503239589f },
    { 149.9493444574f,  74.6806247066f,  219.7741066285f },
    { 148.6255132334f,  74.7413504884f,  220.9105281522f },
    { 147.2866190251f,  74.8341530257f,  222.0589912038f },
    { 145.9321852489f,  74.9601920527f,  223.2188513482f },
    { 144.5617099330f,  75.1206494642f,  224.3894182169f },
    { 143.1746637898f,  75.3167295087f,  225.5699571041f },
    { 141.7704880979f,  75.5496592074f,  226.7596909885f },
    { 140.3485923677f,  75.8206890517f,  227.9578029729f },
    { 138.9083517641f,  76.1310940321f,  229.1634391285f },
    { 137.4491042552f,  76.4821750622f,  230.3757117195f },
    { 135.9701474486f,  76.8752608635f,  231.5937027786f },
    { 134.4707350754f,  77.3117103849f,  232.8164679895f },
    { 132.9500730696f,  77.7929158384f,  234.0430408287f },
    { 131.4073151876f,  78.3203064387f,  235.2724369084f },
    { 129.8415580977f,  78.8953529477f,  236.5036584536f },
    { 128.2518358605f,  79.5195731333f,  237.7356988417f },
    { 126.6371137058f,  80.1945382678f,  238.9675471241f },
    { 124.9962809907f,  80.9218808087f,  240.1981924451f },
    { 123.3281432076f,  81.7033034264f,  241.4266282662f },
    { 121.6314128764f,  82.5405895696f,  242.6518562991f },
    { 119.9046991284f,  83.4356157960f,  243.8728900451f },
    { 118.1464957412f,  84.3903661370f,  245.0887578302f },
    { 116.3551673373f,  85.4069488212f,  246.2985052149f },
    { 114.5289333879f,  86.4876157546f,  247.5011966462f },
    { 112.6658495797f,  87.6347852421f,  248.6959161971f },
    { 110.7637859963f,  88.8510685555f,  249.8817672115f },
    { 108.8204014192f,  90.1393011040f,  251.0578706323f },
    { 106.8331128751f,  91.5025791607f,  252.2233617302f },
    { 104.7990593049f,  92.9443033625f,  253.3773848634f },
    { 102.7150579105f,  94.4682305461f,  254.5190857778f },
    { 100.5775512896f,  96.0785359536f,  255.6476007724f },
    { 98.3825428684f,  97.7798884731f,  256.7620417917f },
    { 96.1255173019f,  99.5775424609f,  257.8614761128f },
    { 97.1955519948f,  97.9465737417f,  259.9554611306f },
    { 98.2483382858f,  96.4797805159f,  262.0566684896f },
    { 99.2846811405f,  95.1706561822f,  264.1609575328f },
    { 100.3053240823f,  94.0128354742f,  266.2640772624f },
    { 101.3109555747f,  93.0000571372f,  268.3617284318f },
    { 102.3022145769f,  92.1261379305f,  270.4496265606f },
    { 103.2796953984f,  91.3849566550f,  272.5235638056f },
    { 104.2439519601f,  90.7704468738f,  274.5794676764f },
    { 105.1955015457f,  90.2765969563f,  276.6134547646f },
    { 106.1348281170f,  89.8974560682f,  278.6218779483f },
    { 107.0623852538f,  89.6271447394f,  280.6013659048f },
    { 107.9785987683f,  89.4598687009f,  282.5488541825f },
    { 108.8838690370f,  89.3899347686f,  284.4616075118f },
    { 109.7785730871f,  89.4117676751f,  286.3372334415f },
    { 110.6630664673f,  89.5199269017f,  288.1736877419f },
    { 111.5376849307f,  89.7091227215f,  289.9692723040f },
    { 112.4027459518f,  89.9742308408f,  291.7226264734f },
    { 113.2585500960f,  90.3103051875f,  293.4327128848f },
    { 114.1053822618f,  90.7125885531f,  295.0987989177f },
    { 114.9435128060f,  91.1765209332f,  296.7204348823f },
    { 115.7731985684f,  91.6977455288f,  298.2974299809f },
    { 116.5946838043f,  92.2721124662f,  299.8298269925f },
    { 117.4082010371f,  92.8956803681f,  301.3178765020f },
    { 118.2139718363f,  93.5647159567f,  302.7620113613f },
    { 119.0122075316f,  94.2756919090f,  304.1628219350f },
    { 119.8031098678f,  95.0252831964f,  305.5210325502f },
    { 120.5868716061f,  95.8103621483f,  306.8374794538f },
    { 121.3636770787f,  96.6279924746f,  308.1130904746f },
    { 122.1337026988f,  97.4754224655f,  309.3488665010f },
    { 122.8971174331f,  98.3500775748f,  310.5458648111f },
    { 123.6540832370f,  99.2495525663f,  311.7051842377f },
    { 124.4047554584f,  100.1716033861f,  312.8279521052f },
    { 125.1492832119f,  101.1141388979f,  313.9153128465f },
    { 125.8878097261f,  102.0752125978f,  314.9684181862f },
    { 126.6204726662f,  103.0530144063f,  315.9884187641f },
    { 127.3474044344f,  104.0458626151f,  316.9764570699f },
    { 128.0687324493f,  105.0521960501f,  317.9336615536f },
    { 128.7845794069f,  106.0705664990f,  318.8611417872f },
    { 129.4950635239f,  107.0996314371f,  319.7599845521f },
    { 130.2002987654f,  108.1381470761f,  320.6312507386f },
    { 130.9003950575f,  109.1849617511f,  321.4759729515f },
    { 131.5954584865f,  110.2390096527f,  322.2951537249f },
    { 132.2855914860f,  111.2993049077f,  323.0897642576f },
    { 132.9708930115f,  112.3649360036f,  323.8607435933f },
    { 133.6514587053f,  113.4350605509f,  324.6089981737f },
    { 134.3273810512f,  114.5089003744f,  325.3354017049f },
    { 134.9987495194f,  115.5857369201f,  326.0407952826f },
    { 135.6656507037f,  116.6649069661f,  326.7259877300f },
    { 136.3281684505f,  117.7457986216f,  327.3917561073f },
    { 136.9863839801f,  118.8278476010f,  328.0388463591f },
    { 137.6403760016f,  119.9105337568f,  328.6679740686f },
    { 138.2902208211f,  120.9933778563f,  329.2798252946f },
    { 138.9359924445f,  122.0759385880f,  329.8750574687f },
    { 139.5777626734f,  123.1578097828f,  330.4543003349f },
    { 140.2156011977f,  124.2386178355f,  331.0181569173f },
    { 140.8495756815f,  125.3180193141f,  331.5672045021f },
    { 141.4797518461f,  126.3956987440f,  332.1019956240f },
    { 142.1061935471f,  127.4713665543f,  332.6230590488f },
    { 142.7289628489f,  128.5447571747f,  333.1309007448f },
    { 143.3481200948f,  129.6156272737f,  333.6260048379f },
    { 142.8744037103f,  129.8668442528f,  334.1148747530f },
    { 142.3984635457f,  130.1287410536f,  334.6078685498f },
    { 141.9202663887f,  130.4015552817f,  335.1050355316f },
    { 141.4397780838f,  130.6855301217f,  335.6064278150f },
    { 140.9569634894f,  130.9809145072f,  336.1121006072f },
    { 140.4717864334f,  131.2879632993f,  336.6221125099f },
    { 139.9842096653f,  131.6069374733f,  337.1365258529f },
    { 139.4941948048f,  131.9381043154f,  337.6554070608f },
    { 139.0017022874f,  132.2817376295f,  338.1788270550f },
    { 138.5066913061f,  132.6381179543f,  338.7068616969f },
    { 138.0091197489f,  133.0075327929f,  339.2395922759f },
    { 137.5089441318f,  133.3902768550f,  339.7771060473f },
    { 137.0061195266f,  133.7866523128f,  340.3194968264f },
    { 136.5005994839f,  134.1969690722f,  340.8668656458f },
    { 135.9923359491f,  134.6215450597f,  341.4193214828f },
    { 135.4812791725f,  135.0607065286f,  341.9769820671f },
    { 134.9673776119f,  135.5147883831f,  342.5399747781f },
    { 134.4505778262f,  135.9841345259f,  343.1084376441f },
    { 133.9308243613f,  136.4690982288f,  343.6825204571f },
    { 133.4080596243f,  136.9700425303f,  344.2623860196f },
    { 132.8822237471f,  137.4873406631f,  344.8482115423f },
    { 132.3532544372f,  138.0213765160f,  345.4401902131f },
    { 131.8210868128f,  138.5725451327f,  346.0385329667f },
    { 131.2856532234f,  139.1412532555f,  346.6434704808f },
    { 130.7468830494f,  139.7279199175f,  347.2552554400f },
    { 130.2047024825f,  140.3329770943f,  347.8741651064f },
    { 129.6590342797f,  140.9568704209f,  348.5005042514f },
    { 129.1097974904f,  141.6000599897f,  349.1346085096f },
    { 128.5569071500f,  142.2630212405f,  349.7768482298f },
    { 128.0002739366f,  142.9462459634f,  350.4276329148f },
    { 127.4398037815f,  143.6502434369f,  351.0874163614f },
    { 126.8753974296f,  144.3755417296f,  351.7567026362f },
    { 126.3069499363f,  145.1226892047f,  352.4360530590f },
    { 125.7343500918f,  145.8922562753f,  353.1260944018f },
    { 125.1574797566f,  146.6848374735f,  353.8275285706f },
    { 124.5762130909f,  147.5010539177f,  354.5411441024f },
    { 123.9904156539f,  148.3415562888f,  355.2678299053f },
    { 123.3999433432f,  149.2070284630f,  356.0085917896f },
    { 122.8046411374f,  150.0981920045f,  356.7645725033f },
    { 122.2043415901f,  151.0158117922f,  357.5370762073f },
    { 121.5988630113f,  151.9607031636f,  358.3275986341f },
    { 120.9880072465f,  152.9337411120f,  359.1378646009f },
    { 120.3715569357f,  153.9358723006f,  359.9698751572f }
};

__CONSTANT__ float gamutCuspTableReach[360] = 
{
    301.276f,
    305.945f,
    310.571f,
    315.131f,
    319.604f,
    323.969f,
    328.210f,
    332.306f,
    336.249f,
    340.009f,
    343.591f,
    346.979f,
    350.165f,
    353.162f,
    355.957f,
    358.557f,
    360.974f,
    363.214f,
    365.283f,
    367.194f,
    368.970f,
    370.612f,
    372.137f,
    373.572f,
    374.915f,
    369.940f,
    356.073f,
    343.317f,
    331.549f,
    320.660f,
    310.559f,
    301.166f,
    292.413f,
    284.241f,
    276.599f,
    269.440f,
    262.720f,
    256.403f,
    250.458f,
    244.861f,
    239.575f,
    234.583f,
    229.865f,
    225.403f,
    221.179f,
    217.169f,
    213.373f,
    209.766f,
    206.342f,
    203.088f,
    200.000f,
    197.058f,
    194.263f,
    191.602f,
    189.075f,
    186.664f,
    184.375f,
    182.190f,
    180.115f,
    178.137f,
    176.257f,
    174.469f,
    172.772f,
    171.155f,
    169.623f,
    168.164f,
    166.785f,
    165.479f,
    164.240f,
    163.068f,
    161.963f,
    160.919f,
    159.943f,
    159.021f,
    158.160f,
    157.355f,
    156.610f,
    155.914f,
    155.273f,
    154.688f,
    154.150f,
    153.662f,
    153.223f,
    152.838f,
    152.496f,
    152.203f,
    151.959f,
    151.764f,
    151.611f,
    151.508f,
    151.447f,
    151.434f,
    151.471f,
    151.550f,
    151.678f,
    151.849f,
    152.069f,
    152.338f,
    152.649f,
    153.015f,
    153.424f,
    153.882f,
    154.395f,
    154.956f,
    155.566f,
    156.232f,
    156.952f,
    157.727f,
    158.557f,
    159.448f,
    160.394f,
    161.401f,
    162.469f,
    163.605f,
    164.807f,
    166.077f,
    167.419f,
    168.835f,
    170.331f,
    171.899f,
    173.553f,
    175.293f,
    177.124f,
    179.047f,
    181.067f,
    183.191f,
    185.425f,
    187.769f,
    190.234f,
    192.822f,
    195.544f,
    198.407f,
    201.410f,
    204.572f,
    207.904f,
    211.407f,
    215.100f,
    218.988f,
    223.090f,
    227.423f,
    231.995f,
    236.829f,
    241.943f,
    247.363f,
    253.113f,
    249.725f,
    243.146f,
    236.987f,
    231.213f,
    225.793f,
    220.697f,
    215.900f,
    211.377f,
    207.104f,
    203.076f,
    199.268f,
    195.660f,
    192.249f,
    189.014f,
    185.944f,
    183.038f,
    180.273f,
    177.655f,
    175.165f,
    172.803f,
    170.551f,
    168.420f,
    166.388f,
    164.459f,
    162.628f,
    160.889f,
    159.235f,
    157.666f,
    156.177f,
    154.767f,
    153.430f,
    152.161f,
    150.964f,
    149.835f,
    148.767f,
    147.760f,
    146.814f,
    145.929f,
    145.093f,
    144.318f,
    143.597f,
    142.926f,
    142.310f,
    141.736f,
    141.217f,
    140.747f,
    140.320f,
    139.948f,
    139.612f,
    139.331f,
    139.087f,
    138.892f,
    138.739f,
    138.635f,
    138.574f,
    138.556f,
    138.580f,
    138.647f,
    138.763f,
    138.916f,
    139.124f,
    139.368f,
    139.661f,
    140.002f,
    140.387f,
    140.820f,
    141.296f,
    141.827f,
    142.407f,
    143.036f,
    143.719f,
    144.452f,
    145.239f,
    146.088f,
    146.991f,
    147.949f,
    148.975f,
    150.061f,
    151.215f,
    152.435f,
    153.729f,
    155.096f,
    156.537f,
    158.057f,
    159.662f,
    161.353f,
    163.141f,
    165.021f,
    167.004f,
    169.092f,
    171.295f,
    173.615f,
    176.062f,
    178.644f,
    181.366f,
    184.247f,
    187.286f,
    190.497f,
    193.896f,
    197.498f,
    201.318f,
    205.371f,
    209.686f,
    214.276f,
    215.375f,
    212.250f,
    209.265f,
    206.415f,
    203.699f,
    201.099f,
    198.621f,
    196.259f,
    193.994f,
    191.840f,
    189.783f,
    187.817f,
    185.944f,
    184.155f,
    182.452f,
    180.829f,
    179.279f,
    177.808f,
    176.410f,
    175.079f,
    173.816f,
    172.620f,
    171.484f,
    170.416f,
    169.403f,
    168.451f,
    167.554f,
    166.711f,
    165.930f,
    165.192f,
    164.514f,
    163.885f,
    163.306f,
    162.775f,
    162.292f,
    161.859f,
    161.475f,
    161.133f,
    160.840f,
    160.590f,
    160.388f,
    160.229f,
    160.120f,
    160.046f,
    160.022f,
    160.046f,
    160.107f,
    160.217f,
    160.370f,
    160.571f,
    160.809f,
    161.096f,
    161.432f,
    161.810f,
    162.231f,
    162.701f,
    163.220f,
    163.788f,
    164.398f,
    165.063f,
    165.771f,
    166.534f,
    167.352f,
    168.213f,
    169.135f,
    170.111f,
    171.136f,
    172.223f,
    173.370f,
    174.573f,
    175.836f,
    177.167f,
    178.558f,
    180.011f,
    181.537f,
    183.130f,
    184.796f,
    186.536f,
    188.348f,
    190.240f,
    192.212f,
    194.269f,
    196.405f,
    198.627f,
    200.940f,
    203.351f,
    205.847f,
    208.441f,
    211.139f,
    213.934f,
    216.833f,
    219.843f,
    222.955f,
    226.178f,
    229.517f,
    232.959f,
    236.523f,
    240.192f,
    243.982f,
    247.876f,
    251.880f,
    255.994f,
    260.205f,
    264.514f,
    268.909f,
    273.389f,
    277.942f,
    282.550f,
    287.201f,
    291.882f,
    296.582f
};

__CONSTANT__ float3 cGamutCuspTable[360] = 
{
    { 130.1170938961f,  204.3793205641f,  0.4305086540f },
    { 129.6197652469f,  205.5710306371f,  1.0240227435f },
    { 129.1181493566f,  206.7834733514f,  1.6330192410f },
    { 128.6120555489f,  208.0169523829f,  2.2591495923f },
    { 128.1012713220f,  209.2717762795f,  2.9043368048f },
    { 127.5855579135f,  210.5482617122f,  3.5708380367f },
    { 127.0646445524f,  211.8467389800f,  4.2613265484f },
    { 126.5382208800f,  213.1675611322f,  4.9790007765f },
    { 126.0059267633f,  214.5111189514f,  5.7277322197f },
    { 125.4673382967f,  215.8778655797f,  6.5122702419f },
    { 124.9219480776f,  217.2683573316f,  7.3385327288f },
    { 124.3691365799f,  218.6833224013f,  8.2140305607f },
    { 123.8081291483f,  220.1237792565f,  9.1485088958f },
    { 123.2379286415f,  221.5912473082f,  10.1549564262f },
    { 122.6572044257f,  223.0881382817f,  11.2512756559f },
    { 122.0640973064f,  224.6185264500f,  12.4632283431f },
    { 121.4558468615f,  226.1897883592f,  13.8300789191f },
    { 120.8279932537f,  227.8165031349f,  15.4167092671f },
    { 120.1723547235f,  229.5314174410f,  17.3443670686f },
    { 119.4702429991f,  231.4264153866f,  19.8939120485f },
    { 118.6490480877f,  233.9514736554f,  24.1663914281f },
    { 120.4678951962f,  225.6991201231f,  25.4173986464f },
    { 122.2347336534f,  218.0716691728f,  26.6876323726f },
    { 123.9545450861f,  211.0033775722f,  27.9775579364f },
    { 125.6315143081f,  204.4395648089f,  29.2874161667f },
    { 127.2691993671f,  198.3342177881f,  30.6172418406f },
    { 128.8706575387f,  192.6482121942f,  31.9668770428f },
    { 130.4385404471f,  187.3479668495f,  33.3359811349f },
    { 131.9751670785f,  182.4044086847f,  34.7240386005f },
    { 133.4825806575f,  177.7921648251f,  36.1303657318f },
    { 134.9625935411f,  173.4889236292f,  37.5541168965f },
    { 136.4168230801f,  169.4749234042f,  38.9942909610f },
    { 137.8467205745f,  165.7325390204f,  40.4497383097f },
    { 139.2535948840f,  162.2459446191f,  41.9191687941f },
    { 140.6386318538f,  159.0008362255f,  43.4011608467f },
    { 142.0029104296f,  155.9842021039f,  44.8941719079f },
    { 143.3474161274f,  153.1841316013f,  46.3965502316f },
    { 144.6730523725f,  150.5896553640f,  47.9065480585f },
    { 145.9806501065f,  148.1906113917f,  49.4223360725f },
    { 147.2709759759f,  145.9775325722f,  50.9420189905f },
    { 148.5447393523f,  143.9415522254f,  52.4636520773f },
    { 149.8025983819f,  142.0743248568f,  53.9852583292f },
    { 151.0451652238f,  140.3679598271f,  55.5048460320f },
    { 152.2730106090f,  138.8149660366f,  57.0204263753f },
    { 153.4866678225f,  137.4082060226f,  58.5300307961f },
    { 154.6866361991f,  136.1408581021f,  60.0317277264f },
    { 155.8733842012f,  135.0063853780f,  61.5236384373f },
    { 157.0473521406f,  133.9985105771f,  63.0039517013f },
    { 158.2089545929f,  133.1111958099f,  64.4709370332f },
    { 159.3585825464f,  132.3386264501f,  65.9229563170f },
    { 160.4966053208f,  131.6751984197f,  67.3584736775f },
    { 161.6233722855f,  131.1155082521f,  68.7760635108f },
    { 162.7392144020f,  130.6543453753f,  70.1744166386f },
    { 163.8444456137f,  130.2866861333f,  71.5523446050f },
    { 164.9393640998f,  130.0076891220f,  72.9087821781f },
    { 166.0242534101f,  129.8126914833f,  74.2427881578f },
    { 167.0993834946f,  129.6972058523f,  75.5535446260f },
    { 168.1650116392f,  129.6569177094f,  76.8403547944f },
    { 169.2213833182f,  129.6876829334f,  78.1026396265f },
    { 170.2687329729f,  129.7855253980f,  79.3399334159f },
    { 171.3072847231f,  129.9466344897f,  80.5518785054f },
    { 172.3372530197f,  130.1673624626f,  81.7382193291f },
    { 173.3588432434f,  130.4442215685f,  82.8987959489f },
    { 174.3722522558f,  130.7738809326f,  84.0335372462f },
    { 175.3776689066f,  131.1531631572f,  85.1424539150f },
    { 176.3752745018f,  131.5790406577f,  86.2256313838f },
    { 177.3652432364f,  132.0486317438f,  87.2832227786f },
    { 178.3477425945f,  132.5591964698f,  88.3154420219f },
    { 179.3229337209f,  133.1081322828f,  89.3225571437f },
    { 180.2909717649f,  133.6929695025f,  90.3048838671f },
    { 181.2520062011f,  134.3113666689f,  91.2627795150f },
    { 182.2061811265f,  134.9611057918f,  92.1966372717f },
    { 183.1536355385f,  135.6400875387f,  93.1068808207f },
    { 184.0945035934f,  136.3463263947f,  93.9939593731f },
    { 185.0289148486f,  137.0779458241f,  94.8583430879f },
    { 185.9569944882f,  137.8331734633f,  95.7005188823f },
    { 186.8788635350f,  138.6103363700f,  96.5209866234f },
    { 187.7946390481f,  139.4078563501f,  97.3202556873f },
    { 188.7044343096f,  140.2242453828f,  98.0988418697f },
    { 189.6083589987f,  141.0581011587f,  98.8572646294f },
    { 190.5065193557f,  141.9081027448f,  99.5960446437f },
    { 189.9716654066f,  141.8560694897f,  100.3241244044f },
    { 189.4345761430f,  141.8276552471f,  101.0575949790f },
    { 188.8952246591f,  141.8233619310f,  101.7962794090f },
    { 188.3535834991f,  141.8436919695f,  102.5399915292f },
    { 187.8096246412f,  141.8891478541f,  103.2885361105f },
    { 187.2633194813f,  141.9602316867f,  104.0417090413f },
    { 186.7146388155f,  142.0574447286f,  104.7992975459f },
    { 186.1635528228f,  142.1812869538f,  105.5610804414f },
    { 185.6100310463f,  142.3322566078f,  106.3268284329f },
    { 185.0540423740f,  142.5108497769f,  107.0963044471f },
    { 184.4955550191f,  142.7175599692f,  107.8692640023f },
    { 183.9345364991f,  142.9528777113f,  108.6454556153f },
    { 183.3709536143f,  143.2172901624f,  109.4246212437f },
    { 182.8047724254f,  143.5112807510f,  110.2064967618f },
    { 182.2359582302f,  143.8353288340f,  110.9908124675f },
    { 181.6644755392f,  144.1899093846f,  111.7772936201f },
    { 181.0902880505f,  144.5754927087f,  112.5656610046f },
    { 180.5133586235f,  144.9925441951f,  113.3556315204f },
    { 179.9336492514f,  145.4415241000f,  114.1469187921f },
    { 179.3511210325f,  145.9228873706f,  114.9392337985f },
    { 178.7657341406f,  146.4370835077f,  115.7322855168f },
    { 178.1774477938f,  146.9845564720f,  116.5257815781f },
    { 177.5862202219f,  147.5657446338f,  117.3194289313f },
    { 176.9920086329f,  148.1810807699f,  118.1129345113f },
    { 176.3947691773f,  148.8309921079f,  118.9060059073f },
    { 175.7944569113f,  149.5159004204f,  119.6983520288f },
    { 175.1910257579f,  150.2362221691f,  120.4896837635f },
    { 174.5844284668f,  150.9923687010f,  121.2797146258f },
    { 173.9746165719f,  151.7847464965f,  122.0681613909f },
    { 173.3615403471f,  152.6137574710f,  122.8547447111f },
    { 172.7451487600f,  153.4797993283f,  123.6391897117f },
    { 172.1253894234f,  154.3832659690f,  124.4212265640f },
    { 171.5022085439f,  155.3245479506f,  125.2005910305f },
    { 170.8755508692f,  156.3040330021f,  125.9770249830f },
    { 170.2453596318f,  157.3221065900f,  126.7502768879f },
    { 169.6115764901f,  158.3791525379f,  127.5201022600f },
    { 168.9741414666f,  159.4755536967f,  128.2862640810f },
    { 168.3329928831f,  160.6116926672f,  129.0485331824f },
    { 167.6880672928f,  161.7879525723f,  129.8066885913f },
    { 167.0392994076f,  163.0047178801f,  130.5605178389f },
    { 166.3866220236f,  164.2623752754f,  131.3098172314f },
    { 165.7299659404f,  165.5613145813f,  132.0543920825f },
    { 165.0692598783f,  166.9019297283f,  132.7940569088f },
    { 164.4044303888f,  168.2846197722f,  133.5286355873f },
    { 163.7354017619f,  169.7097899598f,  134.2579614768f },
    { 163.0620959272f,  171.1778528428f,  134.9818775043f },
    { 162.3844323499f,  172.6892294406f,  135.7002362164f },
    { 161.7023279205f,  174.2443504510f,  136.4128997979f },
    { 161.0156968384f,  175.8436575126f,  137.1197400595f },
    { 160.3244504884f,  177.4876045164f,  137.8206383955f },
    { 159.6284973100f,  179.1766589715f,  138.5154857134f },
    { 158.9277426589f,  180.9113034249f,  139.2041823378f },
    { 158.2220886598f,  182.6920369385f,  139.8866378903f },
    { 157.5114340501f,  184.5193766263f,  140.5627711472f },
    { 156.7956740139f,  186.3938592549f,  141.2325098771f },
    { 156.0747000057f,  188.3160429122f,  141.8957906612f },
    { 155.3483995618f,  190.2865087473f,  142.5525586964f },
    { 154.6166561005f,  192.3058627889f,  143.2027675865f },
    { 153.8793487080f,  194.3747378472f,  143.8463791193f },
    { 153.1363519107f,  196.4937955063f,  144.4833630360f },
    { 153.6153058895f,  189.1147996037f,  145.9970402532f },
    { 154.0674853864f,  183.1781485498f,  147.3437974747f },
    { 154.5020669528f,  178.1764882205f,  148.5827652857f },
    { 154.9238874129f,  173.8424153500f,  149.7450803480f },
    { 155.3358574777f,  170.0150201200f,  150.8494120366f },
    { 155.7398861244f,  166.5887805942f,  151.9079309474f },
    { 156.1373038032f,  163.4901659196f,  152.9290491454f },
    { 156.5290808276f,  160.6655624124f,  153.9188373796f },
    { 156.9159502736f,  158.0744784598f,  154.8818240688f },
    { 157.2984818584f,  155.6854593261f,  155.8214763260f },
    { 157.6771287254f,  153.4734998319f,  156.7405049684f },
    { 158.0522583478f,  151.4183350329f,  157.6410662244f },
    { 158.4241736692f,  149.5032707836f,  158.5248998540f },
    { 158.7931279965f,  147.7143597648f,  159.3934265470f },
    { 159.1593357589f,  146.0398061405f,  160.2478183500f },
    { 159.5229804520f,  144.4695259562f,  161.0890507075f },
    { 159.8842206147f,  142.9948163224f,  161.9179416553f },
    { 160.2431944032f,  141.6081022646f,  162.7351818321f },
    { 160.6000231431f,  140.3027401146f,  163.5413578037f },
    { 160.9548141250f,  139.0728627755f,  164.3369704312f },
    { 161.3076628311f,  137.9132564838f,  165.1224495064f },
    { 161.6586547279f,  136.8192615933f,  165.8981655380f },
    { 162.0078667241f,  135.7866919144f,  166.6644393336f },
    { 162.3553683668f,  134.8117685507f,  167.4215498574f },
    { 162.7012228304f,  133.8910651810f,  168.1697407232f },
    { 163.0454877414f,  133.0214624658f,  168.9092255968f },
    { 163.3882158711f,  132.2001097926f,  169.6401927206f },
    { 163.7294557195f,  131.4243929710f,  170.3628087218f },
    { 164.0692520129f,  130.6919067899f,  171.0772218359f },
    { 164.4076461286f,  130.0004315742f,  171.7835646453f },
    { 164.7446764598f,  129.3479130543f,  172.4819564159f },
    { 165.0803787308f,  128.7324449960f,  173.1725050971f },
    { 165.4147862699f,  128.1522541426f,  173.8553090381f },
    { 165.7479302484f,  127.6056871072f,  174.5304584645f },
    { 166.0798398881f,  127.0911989132f,  175.1980367502f },
    { 166.4105426444f,  126.6073429398f,  175.8581215159f },
    { 166.7400643675f,  126.1527620664f,  176.5107855773f },
    { 167.0684294452f,  125.7261808462f,  177.1560977636f },
    { 167.3956609286f,  125.3263985664f,  177.7941236259f },
    { 167.7217806455f,  124.9522830752f,  178.4249260476f },
    { 168.0468093003f,  124.6027652746f,  179.0485657711f },
    { 168.3707665638f,  124.2768341915f,  179.6651018510f },
    { 168.6936711543f,  123.9735325561f,  180.2745920433f },
    { 169.0155409101f,  123.6919528229f,  180.8770931381f },
    { 169.3363928546f,  123.4312335819f,  181.4726612433f },
    { 169.6562432558f,  123.1905563130f,  182.0613520250f },
    { 169.9751076800f,  122.9691424444f,  182.6432209102f },
    { 170.2930010403f,  122.7662506789f,  183.2183232558f },
    { 170.6099376411f,  122.5811745607f,  183.7867144885f },
    { 170.9259312184f,  122.4132402527f,  184.3484502193f },
    { 171.2409949764f,  122.2618045056f,  184.9035863347f },
    { 171.5551416221f,  122.1262527953f,  185.4521790690f },
    { 171.8683833954f,  122.0059976132f,  185.9942850585f },
    { 172.1807320979f,  121.9004768927f,  186.5299613812f },
    { 172.4921991192f,  121.8091525591f,  187.0592655832f },
    { 172.8027954607f,  121.7315091900f,  187.5822556932f },
    { 173.1125317579f,  121.6670527763f,  188.0989902279f },
    { 173.4214183011f,  121.6153095737f,  188.6095281884f },
    { 173.7294650544f,  121.5758250368f,  189.1139290492f },
    { 174.0366816728f,  121.5481628280f,  189.6122527415f },
    { 173.0278840990f,  120.7684150018f,  190.1131265788f },
    { 172.0114849721f,  119.9916223825f,  190.6248807820f },
    { 170.9873276648f,  119.2180899884f,  191.1478232881f },
    { 169.9552501615f,  118.4481403177f,  191.6822705146f },
    { 168.9150847964f,  117.6821143396f,  192.2285474022f },
    { 167.8666579748f,  116.9203725406f,  192.7869874276f },
    { 166.8097898771f,  116.1632960283f,  193.3579325825f },
    { 165.7442941425f,  115.4112876959f,  193.9417333139f },
    { 164.6699775329f,  114.6647734499f,  194.5387484194f },
    { 163.5866395740f,  113.9242035035f,  195.1493448939f },
    { 162.4940721712f,  113.1900537382f,  195.7738977183f },
    { 161.3920592001f,  112.4628271372f,  196.4127895869f },
    { 160.2803760679f,  111.7430552929f,  197.0664105627f },
    { 159.1587892430f,  111.0312999906f,  197.7351576555f },
    { 158.0270557517f,  110.3281548714f,  198.4194343120f },
    { 156.8849226365f,  109.6342471776f,  199.1196498111f },
    { 155.7321263756f,  108.9502395811f,  199.8362185519f },
    { 154.5683922568f,  108.2768320987f,  200.5695592273f },
    { 153.3934337037f,  107.6147640959f,  201.3200938711f },
    { 152.2069515490f,  106.9648163809f,  202.0882467673f },
    { 151.0086332494f,  106.3278133898f,  202.8744432118f },
    { 149.7981520371f,  105.7046254671f,  203.6791081147f },
    { 148.5751659999f,  105.0961712393f,  204.5026644313f },
    { 147.3393170846f,  104.5034200858f,  205.3455314132f },
    { 146.0902300146f,  103.9273947074f,  206.2081226661f },
    { 144.8275111114f,  103.3691737923f,  207.0908440084f },
    { 143.5507470124f,  102.8298947833f,  207.9940911194f },
    { 142.2595032698f,  102.3107567465f,  208.9182469738f },
    { 140.9533228207f,  101.8130233432f,  209.8636790551f },
    { 139.6317243106f,  101.3380259102f,  210.8307363490f },
    { 138.2942002542f,  100.8871666512f,  211.8197461178f },
    { 136.9402150140f,  100.4619219467f,  212.8310104606f },
    { 135.5692025734f,  100.0638457908f,  213.8648026719f },
    { 134.1805640788f,  99.6945733680f,  214.9213634115f },
    { 132.7736651204f,  99.3558247856f,  216.0008967102f },
    { 131.3478327166f,  99.0494089861f,  217.1035658383f },
    { 129.9023519636f,  98.7772278668f,  218.2294890726f },
    { 128.4364623003f,  98.5412806493f,  219.3787354055f },
    { 126.9493533363f,  98.3436685453f,  220.5513202490f },
    { 125.4401601773f,  98.1865997877f,  221.7472011910f },
    { 123.9079581723f,  98.0723951066f,  222.9662738742f },
    { 122.3517569930f,  98.0034937568f,  224.2083680721f },
    { 120.7704939382f,  97.9824602261f,  225.4732440438f },
    { 119.1630263372f,  98.0119917892f,  226.7605892561f },
    { 117.5281228967f,  98.0949271095f,  228.0700155639f },
    { 115.8644538101f,  98.2342561422f,  229.4010569404f },
    { 114.1705794015f,  98.4331316473f,  230.7531678472f },
    { 112.4449370351f,  98.6948826996f,  232.1257223283f },
    { 110.6858259505f,  99.0230306685f,  233.5180139015f },
    { 108.8913896119f,  99.4213082542f,  234.9292563019f },
    { 107.0595950526f,  99.8936823097f,  236.3585851142f },
    { 105.1882085666f,  100.4443813527f,  237.8050602934f },
    { 103.2747669256f,  101.0779289023f,  239.2676695359f },
    { 101.3165430740f,  101.7991840716f,  240.7453324078f },
    { 99.3105049494f,  102.6133912320f,  242.2369050647f },
    { 97.2532656691f,  103.5262410858f,  243.7411853016f },
    { 95.1410227636f,  104.5439461749f,  245.2569175406f },
    { 92.9694833644f,  105.6733348070f,  246.7827971773f },
    { 90.7337711677f,  106.9219687049f,  248.3174734371f },
    { 88.4283094406f,  108.2982915529f,  249.8595494854f },
    { 89.9275734108f,  105.0489453574f,  252.9249904440f },
    { 91.3882635983f,  102.2116999878f,  256.0412451847f },
    { 92.8132041353f,  99.7667681312f,  259.1955305977f },
    { 94.2048890783f,  97.6950439164f,  262.3735905627f },
    { 95.5655339205f,  95.9776645536f,  265.5601230978f },
    { 96.8971172303f,  94.5957171589f,  268.7392798580f },
    { 98.2014146299f,  93.5300773937f,  271.8952022706f },
    { 99.4800267686f,  92.7613635516f,  275.0125528293f },
    { 100.7344025345f,  92.2699859413f,  278.0770004412f },
    { 101.9658584585f,  92.0362683203f,  281.0756250947f },
    { 103.1755950469f,  92.0406167580f,  283.9972180429f },
    { 104.3647106142f,  92.2637120841f,  286.8324668070f },
    { 105.5342130683f,  92.6867048893f,  289.5740270931f },
    { 106.6850300071f,  93.2913963160f,  292.2164941266f },
    { 107.8180174109f,  94.0603928628f,  294.7562927761f },
    { 108.9339671634f,  94.9772283781f,  297.1915089386f },
    { 110.0336135874f,  96.0264507600f,  299.5216844942f },
    { 111.1176391489f,  97.1936742829f,  301.7475956366f },
    { 112.1866794547f,  98.4656008184f,  303.8710305719f },
    { 113.2413276478f,  99.8300145911f,  305.8945783249f },
    { 114.2821382867f,  101.2757556671f,  307.8214363604f },
    { 115.3096307813f,  102.7926773403f,  309.6552412810f },
    { 116.3242924440f,  104.3715921531f,  311.3999241809f },
    { 117.3265812099f,  106.0042106510f,  313.0595902992f },
    { 118.3169280671f,  107.6830762472f,  314.6384213614f },
    { 119.2957392337f,  109.4014988584f,  316.1405982719f },
    { 120.2633981149f,  111.1534893202f,  317.5702415022f },
    { 121.2202670646f,  112.9336960251f,  318.9313664774f },
    { 122.1666889765f,  114.7373447638f,  320.2278514032f },
    { 123.1029887229f,  116.5601823756f,  321.4634152109f },
    { 124.0294744603f,  118.3984245317f,  322.6416035861f },
    { 124.9464388154f,  120.2487077611f,  323.7657813426f },
    { 125.8541599646f,  122.1080456769f,  324.8391296843f },
    { 126.7529026190f,  123.9737892554f,  325.8646471592f },
    { 127.6429189250f,  125.8435909540f,  326.8451533335f },
    { 128.5244492884f,  127.7153724109f,  327.7832944114f },
    { 129.3977231300f,  129.5872954529f,  328.6815501884f },
    { 130.2629595800f,  131.4577361299f,  329.5422418602f },
    { 131.1203681169f,  133.3252615013f,  330.3675403220f },
    { 131.9701491560f,  135.1886089103f,  331.1594746804f },
    { 132.8124945923f,  137.0466674972f,  331.9199407696f },
    { 133.6475883031f,  138.8984617217f,  332.6507095238f },
    { 134.4756066113f,  140.7431366832f,  333.3534350960f },
    { 135.2967187169f,  142.5799450452f,  334.0296626530f },
    { 136.1110870954f,  144.4082353904f,  334.6808357974f },
    { 136.9188678690f,  146.2274418487f,  335.3083035915f },
    { 137.7202111512f,  148.0370748588f,  335.9133271695f },
    { 138.5152613684f,  149.8367129358f,  336.4970859381f },
    { 139.3041575587f,  151.6259953341f,  337.0606833710f },
    { 140.0870336515f,  153.4046155045f,  337.6051524102f },
    { 140.8640187282f,  155.1723152585f,  338.1314604906f },
    { 141.6352372664f,  156.9288795590f,  338.6405142053f },
    { 142.4008093680f,  158.6741318700f,  339.1331636328f },
    { 143.1608509733f,  160.4079300006f,  339.6102063449f },
    { 143.9154740617f,  162.1301623914f,  340.0723911179f },
    { 144.6647868397f,  163.8407447926f,  340.5204213656f },
    { 145.4088939183f,  165.5396172916f,  340.9549583138f },
    { 146.1478964788f,  167.2267416517f,  341.3766239365f },
    { 146.8818924300f,  168.9020989288f,  341.7860036695f },
    { 147.6109765549f,  170.5656873353f,  342.1836489191f },
    { 147.2159637123f,  171.1433628313f,  342.5751611577f },
    { 146.8192436231f,  171.7322225043f,  342.9686427648f },
    { 146.4207906696f,  172.3324343554f,  343.3641375393f },
    { 146.0205784798f,  172.9441694565f,  343.7616924866f },
    { 145.6185798921f,  173.5676020219f,  344.1613580574f },
    { 145.2147669181f,  174.2029094801f,  344.5631884070f },
    { 144.8091107018f,  174.8502725460f,  344.9672416783f },
    { 144.4015814773f,  175.5098752944f,  345.3735803098f },
    { 143.9921485226f,  176.1819052324f,  345.7822713714f },
    { 143.5807801104f,  176.8665533729f,  346.1933869330f },
    { 143.1674434549f,  177.5640143069f,  346.6070044667f },
    { 142.7521046553f,  178.2744862753f,  347.0232072890f },
    { 142.3347286339f,  178.9981712392f,  347.4420850476f },
    { 141.9152790701f,  179.7352749485f,  347.8637342561f },
    { 141.4937183287f,  180.4860070082f,  348.2882588859f },
    { 141.0700073818f,  181.2505809417f,  348.7157710196f },
    { 140.6441057250f,  182.0292142499f,  349.1463915763f },
    { 140.2159712846f,  182.8221284661f,  349.5802511168f },
    { 139.7855603183f,  183.6295492050f,  350.0174907407f },
    { 139.3528273048f,  184.4517062051f,  350.4582630878f },
    { 138.9177248238f,  185.2888333624f,  350.9027334587f },
    { 138.4802034237f,  186.1411687558f,  351.3510810732f },
    { 138.0402114759f,  187.0089546603f,  351.8035004854f },
    { 137.5976950138f,  187.8924375486f,  352.2602031820f },
    { 137.1525975534f,  188.7918680767f,  352.7214193915f },
    { 136.7048598947f,  189.7075010540f,  353.1874001392f },
    { 136.2544198991f,  190.6395953939f,  353.6584195898f },
    { 135.8012122402f,  191.5884140427f,  354.1347777270f },
    { 135.3451681225f,  192.5542238859f,  354.6168034307f },
    { 134.8862149645f,  193.5372956271f,  355.1048580239f },
    { 134.4242760376f,  194.5379036404f,  355.5993393809f },
    { 133.9592700545f,  195.5563257912f,  356.1006867043f },
    { 133.4911106968f,  196.5928432286f,  356.6093861094f },
    { 133.0197060697f,  197.6477401468f,  357.1259771837f },
    { 132.5449580694f,  198.7213035205f,  357.6510607367f },
    { 132.0667616434f,  199.8138228210f,  358.1853080084f },
    { 131.5850039212f,  200.9255897261f,  358.7294716825f },
    { 131.0995631833f,  202.0568978439f,  359.2843991482f },
    { 130.6103076299f,  203.2080424891f,  359.8510485880f }
};

__CONSTANT__ float cGamutReachTable[360] = 
{
    301.276f,
    305.945f,
    310.571f,
    315.131f,
    319.604f,
    323.969f,
    328.210f,
    332.306f,
    336.249f,
    340.009f,
    343.591f,
    346.979f,
    350.165f,
    353.162f,
    355.957f,
    358.557f,
    360.974f,
    363.214f,
    365.283f,
    367.194f,
    368.970f,
    370.612f,
    372.137f,
    373.572f,
    374.915f,
    369.940f,
    356.073f,
    343.317f,
    331.549f,
    320.660f,
    310.559f,
    301.166f,
    292.413f,
    284.241f,
    276.599f,
    269.440f,
    262.720f,
    256.403f,
    250.458f,
    244.861f,
    239.575f,
    234.583f,
    229.865f,
    225.403f,
    221.179f,
    217.169f,
    213.373f,
    209.766f,
    206.342f,
    203.088f,
    200.000f,
    197.058f,
    194.263f,
    191.602f,
    189.075f,
    186.664f,
    184.375f,
    182.190f,
    180.115f,
    178.137f,
    176.257f,
    174.469f,
    172.772f,
    171.155f,
    169.623f,
    168.164f,
    166.785f,
    165.479f,
    164.240f,
    163.068f,
    161.963f,
    160.919f,
    159.943f,
    159.021f,
    158.160f,
    157.355f,
    156.610f,
    155.914f,
    155.273f,
    154.688f,
    154.150f,
    153.662f,
    153.223f,
    152.838f,
    152.496f,
    152.203f,
    151.959f,
    151.764f,
    151.611f,
    151.508f,
    151.447f,
    151.434f,
    151.471f,
    151.550f,
    151.678f,
    151.849f,
    152.069f,
    152.338f,
    152.649f,
    153.015f,
    153.424f,
    153.882f,
    154.395f,
    154.956f,
    155.566f,
    156.232f,
    156.952f,
    157.727f,
    158.557f,
    159.448f,
    160.394f,
    161.401f,
    162.469f,
    163.605f,
    164.807f,
    166.077f,
    167.419f,
    168.835f,
    170.331f,
    171.899f,
    173.553f,
    175.293f,
    177.124f,
    179.047f,
    181.067f,
    183.191f,
    185.425f,
    187.769f,
    190.234f,
    192.822f,
    195.544f,
    198.407f,
    201.410f,
    204.572f,
    207.904f,
    211.407f,
    215.100f,
    218.988f,
    223.090f,
    227.423f,
    231.995f,
    236.829f,
    241.943f,
    247.363f,
    253.113f,
    249.725f,
    243.146f,
    236.987f,
    231.213f,
    225.793f,
    220.697f,
    215.900f,
    211.377f,
    207.104f,
    203.076f,
    199.268f,
    195.660f,
    192.249f,
    189.014f,
    185.944f,
    183.038f,
    180.273f,
    177.655f,
    175.165f,
    172.803f,
    170.551f,
    168.420f,
    166.388f,
    164.459f,
    162.628f,
    160.889f,
    159.235f,
    157.666f,
    156.177f,
    154.767f,
    153.430f,
    152.161f,
    150.964f,
    149.835f,
    148.767f,
    147.760f,
    146.814f,
    145.929f,
    145.093f,
    144.318f,
    143.597f,
    142.926f,
    142.310f,
    141.736f,
    141.217f,
    140.747f,
    140.320f,
    139.948f,
    139.612f,
    139.331f,
    139.087f,
    138.892f,
    138.739f,
    138.635f,
    138.574f,
    138.556f,
    138.580f,
    138.647f,
    138.763f,
    138.916f,
    139.124f,
    139.368f,
    139.661f,
    140.002f,
    140.387f,
    140.820f,
    141.296f,
    141.827f,
    142.407f,
    143.036f,
    143.719f,
    144.452f,
    145.239f,
    146.088f,
    146.991f,
    147.949f,
    148.975f,
    150.061f,
    151.215f,
    152.435f,
    153.729f,
    155.096f,
    156.537f,
    158.057f,
    159.662f,
    161.353f,
    163.141f,
    165.021f,
    167.004f,
    169.092f,
    171.295f,
    173.615f,
    176.062f,
    178.644f,
    181.366f,
    184.247f,
    187.286f,
    190.497f,
    193.896f,
    197.498f,
    201.318f,
    205.371f,
    209.686f,
    214.276f,
    215.375f,
    212.250f,
    209.265f,
    206.415f,
    203.699f,
    201.099f,
    198.621f,
    196.259f,
    193.994f,
    191.840f,
    189.783f,
    187.817f,
    185.944f,
    184.155f,
    182.452f,
    180.829f,
    179.279f,
    177.808f,
    176.410f,
    175.079f,
    173.816f,
    172.620f,
    171.484f,
    170.416f,
    169.403f,
    168.451f,
    167.554f,
    166.711f,
    165.930f,
    165.192f,
    164.514f,
    163.885f,
    163.306f,
    162.775f,
    162.292f,
    161.859f,
    161.475f,
    161.133f,
    160.840f,
    160.590f,
    160.388f,
    160.229f,
    160.120f,
    160.046f,
    160.022f,
    160.046f,
    160.107f,
    160.217f,
    160.370f,
    160.571f,
    160.809f,
    161.096f,
    161.432f,
    161.810f,
    162.231f,
    162.701f,
    163.220f,
    163.788f,
    164.398f,
    165.063f,
    165.771f,
    166.534f,
    167.352f,
    168.213f,
    169.135f,
    170.111f,
    171.136f,
    172.223f,
    173.370f,
    174.573f,
    175.836f,
    177.167f,
    178.558f,
    180.011f,
    181.537f,
    183.130f,
    184.796f,
    186.536f,
    188.348f,
    190.240f,
    192.212f,
    194.269f,
    196.405f,
    198.627f,
    200.940f,
    203.351f,
    205.847f,
    208.441f,
    211.139f,
    213.934f,
    216.833f,
    219.843f,
    222.955f,
    226.178f,
    229.517f,
    232.959f,
    236.523f,
    240.192f,
    243.982f,
    247.876f,
    251.880f,
    255.994f,
    260.205f,
    264.514f,
    268.909f,
    273.389f,
    277.942f,
    282.550f,
    287.201f,
    291.882f,
    296.582f
};

__CONSTANT__ float gamutTopGamma[360] = 
{
    0.888574218750000f,
    0.887567138671875f,
    0.886590576171875f,
    0.885638427734375f,
    0.884716796875000f,
    0.883825683593750f,
    0.882971191406250f,
    0.882147216796875f,
    0.881359863281250f,
    0.880615234375000f,
    0.879907226562500f,
    0.879241943359375f,
    0.878619384765625f,
    0.878033447265625f,
    0.877496337890625f,
    0.877001953125000f,
    0.876550292968750f,
    0.876147460937500f,
    0.875769042968750f,
    0.875451660156250f,
    0.875164794921875f,
    0.874908447265625f,
    0.874713134765625f,
    0.874536132812500f,
    0.874371337890625f,
    0.874267578125000f,
    0.874212646484375f,
    0.874212646484375f,
    0.875903320312500f,
    0.878521728515625f,
    0.880957031250000f,
    0.883264160156250f,
    0.885510253906250f,
    0.887634277343750f,
    0.889648437500000f,
    0.891638183593750f,
    0.893505859375000f,
    0.895318603515625f,
    0.897113037109375f,
    0.898785400390625f,
    0.900439453125000f,
    0.902062988281250f,
    0.903594970703125f,
    0.905126953125000f,
    0.906604003906250f,
    0.908038330078125f,
    0.909478759765625f,
    0.910833740234375f,
    0.912194824218750f,
    0.913525390625000f,
    0.914813232421875f,
    0.916119384765625f,
    0.917358398437500f,
    0.918597412109375f,
    0.919836425781250f,
    0.921020507812500f,
    0.922222900390625f,
    0.923394775390625f,
    0.924548339843750f,
    0.925720214843750f,
    0.926843261718750f,
    0.927972412109375f,
    0.929107666015625f,
    0.930200195312500f,
    0.931311035156250f,
    0.932427978515625f,
    0.933502197265625f,
    0.934594726562500f,
    0.935699462890625f,
    0.936767578125000f,
    0.937847900390625f,
    0.938946533203125f,
    0.940020751953125f,
    0.941094970703125f,
    0.942181396484375f,
    0.943286132812500f,
    0.944366455078125f,
    0.945452880859375f,
    0.946551513671875f,
    0.947662353515625f,
    0.948785400390625f,
    0.949908447265625f,
    0.951025390625000f,
    0.952166748046875f,
    0.953314208984375f,
    0.954479980468750f,
    0.955657958984375f,
    0.956848144531250f,
    0.958062744140625f,
    0.959289550781250f,
    0.960540771484375f,
    0.961810302734375f,
    0.963116455078125f,
    0.964453125000000f,
    0.956127929687500f,
    0.940130615234375f,
    0.923968505859375f,
    0.907543945312500f,
    0.890734863281250f,
    0.873480224609375f,
    0.855541992187500f,
    0.836816406250000f,
    0.829168701171875f,
    0.833087158203125f,
    0.836773681640625f,
    0.840258789062500f,
    0.843548583984375f,
    0.846667480468750f,
    0.849627685546875f,
    0.852441406250000f,
    0.855120849609375f,
    0.857678222656250f,
    0.860113525390625f,
    0.862445068359375f,
    0.864678955078125f,
    0.866815185546875f,
    0.868865966796875f,
    0.870837402343750f,
    0.872729492187500f,
    0.874548339843750f,
    0.876293945312500f,
    0.877984619140625f,
    0.879608154296875f,
    0.881170654296875f,
    0.882684326171875f,
    0.884143066406250f,
    0.885546875000000f,
    0.886907958984375f,
    0.888220214843750f,
    0.889489746093750f,
    0.890716552734375f,
    0.891900634765625f,
    0.893048095703125f,
    0.894152832031250f,
    0.895220947265625f,
    0.896258544921875f,
    0.897253417968750f,
    0.898211669921875f,
    0.899139404296875f,
    0.900024414062500f,
    0.902935791015625f,
    0.906201171875000f,
    0.909265136718750f,
    0.912139892578125f,
    0.914843750000000f,
    0.917382812500000f,
    0.919775390625000f,
    0.922027587890625f,
    0.924157714843750f,
    0.926171875000000f,
    0.928076171875000f,
    0.929876708984375f,
    0.931585693359375f,
    0.933203125000000f,
    0.934741210937500f,
    0.936193847656250f,
    0.937579345703125f,
    0.938891601562500f,
    0.940136718750000f,
    0.941320800781250f,
    0.942443847656250f,
    0.943505859375000f,
    0.944512939453125f,
    0.945465087890625f,
    0.946368408203125f,
    0.947216796875000f,
    0.948016357421875f,
    0.948773193359375f,
    0.949481201171875f,
    0.950140380859375f,
    0.950762939453125f,
    0.951330566406250f,
    0.951855468750000f,
    0.952331542968750f,
    0.952764892578125f,
    0.953161621093750f,
    0.953509521484375f,
    0.953814697265625f,
    0.954071044921875f,
    0.954290771484375f,
    0.954455566406250f,
    0.954565429687500f,
    0.954632568359375f,
    0.954644775390625f,
    0.954614257812500f,
    0.954522705078125f,
    0.954370117187500f,
    0.954156494140625f,
    0.953881835937500f,
    0.953546142578125f,
    0.953131103515625f,
    0.952648925781250f,
    0.952081298828125f,
    0.951428222656250f,
    0.950689697265625f,
    0.967315673828125f,
    0.969042968750000f,
    0.969970703125000f,
    0.970758056640625f,
    0.971453857421875f,
    0.972070312500000f,
    0.972625732421875f,
    0.973095703125000f,
    0.973516845703125f,
    0.973895263671875f,
    0.974230957031250f,
    0.974536132812500f,
    0.974804687500000f,
    0.975048828125000f,
    0.975262451171875f,
    0.975451660156250f,
    0.975622558593750f,
    0.975769042968750f,
    0.975903320312500f,
    0.976019287109375f,
    0.976116943359375f,
    0.976202392578125f,
    0.976281738281250f,
    0.976342773437500f,
    0.976397705078125f,
    0.976440429687500f,
    0.976477050781250f,
    0.976507568359375f,
    0.976513671875000f,
    0.976519775390625f,
    0.976519775390625f,
    0.976513671875000f,
    0.976495361328125f,
    0.976483154296875f,
    0.976446533203125f,
    0.976409912109375f,
    0.976367187500000f,
    0.976318359375000f,
    0.976269531250000f,
    0.976208496093750f,
    0.976141357421875f,
    0.976062011718750f,
    0.975982666015625f,
    0.975903320312500f,
    0.975811767578125f,
    0.975714111328125f,
    0.975604248046875f,
    0.975494384765625f,
    0.975372314453125f,
    0.975250244140625f,
    0.975122070312500f,
    0.974975585937500f,
    0.974822998046875f,
    0.974670410156250f,
    0.974505615234375f,
    0.974328613281250f,
    0.974145507812500f,
    0.973944091796875f,
    0.973736572265625f,
    0.973510742187500f,
    0.973278808593750f,
    0.973028564453125f,
    0.972766113281250f,
    0.972521972656250f,
    0.972509765625000f,
    0.972564697265625f,
    0.972546386718750f,
    0.972601318359375f,
    0.972583007812500f,
    0.972625732421875f,
    0.972619628906250f,
    0.972650146484375f,
    0.972650146484375f,
    0.972674560546875f,
    0.972680664062500f,
    0.972698974609375f,
    0.972711181640625f,
    0.972723388671875f,
    0.972735595703125f,
    0.972741699218750f,
    0.972760009765625f,
    0.972760009765625f,
    0.972778320312500f,
    0.972778320312500f,
    0.972796630859375f,
    0.972796630859375f,
    0.972808837890625f,
    0.972814941406250f,
    0.972821044921875f,
    0.972827148437500f,
    0.972833251953125f,
    0.972845458984375f,
    0.972839355468750f,
    0.972857666015625f,
    0.972845458984375f,
    0.972869873046875f,
    0.972851562500000f,
    0.972863769531250f,
    0.972863769531250f,
    0.972857666015625f,
    0.972875976562500f,
    0.972857666015625f,
    0.972869873046875f,
    0.972863769531250f,
    0.972857666015625f,
    0.972869873046875f,
    0.972857666015625f,
    0.972845458984375f,
    0.972851562500000f,
    0.972851562500000f,
    0.972833251953125f,
    0.972827148437500f,
    0.972827148437500f,
    0.972821044921875f,
    0.972802734375000f,
    0.972784423828125f,
    0.972772216796875f,
    0.972766113281250f,
    0.972753906250000f,
    0.972741699218750f,
    0.972723388671875f,
    0.972705078125000f,
    0.972680664062500f,
    0.972650146484375f,
    0.972619628906250f,
    0.972589111328125f,
    0.972552490234375f,
    0.972515869140625f,
    0.972485351562500f,
    0.972436523437500f,
    0.972387695312500f,
    0.972344970703125f,
    0.972277832031250f,
    0.972222900390625f,
    0.967706298828125f,
    0.957025146484375f,
    0.946466064453125f,
    0.935980224609375f,
    0.925573730468750f,
    0.918627929687500f,
    0.917407226562500f,
    0.916192626953125f,
    0.914978027343750f,
    0.913769531250000f,
    0.912567138671875f,
    0.911364746093750f,
    0.910168457031250f,
    0.908972167968750f,
    0.907781982421875f,
    0.906591796875000f,
    0.905407714843750f,
    0.904229736328125f,
    0.903051757812500f,
    0.901879882812500f,
    0.900714111328125f,
    0.899554443359375f,
    0.898406982421875f,
    0.897259521484375f,
    0.896130371093750f,
    0.895007324218750f,
    0.893890380859375f,
    0.892797851562500f,
    0.891711425781250f,
    0.890643310546875f,
    0.889599609375000f
};

#include "hellwig_lib_v055.h"

__DEVICE__ float3 transform(int p_Width, int p_Height, int p_X, int p_Y, float p_R, float p_G, float p_B)
{
    float3 in = make_float3(p_R, p_G, p_B);
    float3 out = in;

    float3 XYZ;

    if (!invert)
    {
        XYZ = vector_dot(AP0_ACES_to_XYZ_matrix, in);
        if (ap1Clip)
        {
            float3 AP1 = vector_dot(XYZ_to_AP1_ACES_matrix, XYZ);
            AP1.x = _fmaxf(AP1.x, 0.0f);
            AP1.y = _fmaxf(AP1.y, 0.0f);
            AP1.z = _fmaxf(AP1.z, 0.0f);
            XYZ = vector_dot(AP1_ACES_to_XYZ_matrix, AP1);
        }
    }
    else
    {
        in = float3spow(in, 2.4f); // TO DO PQ invert
        XYZ = vector_dot(RGB_to_XYZ_output, in);
    }
    XYZ *= referenceLuminance;
    float3 JMh;
    if (!invert)
    {
        JMh = XYZ_to_Hellwig2022_JMh(XYZ, inWhite);
        if (toneCurve)
        {
            JMh = forwardTonescale(JMh, compressChroma);
        }
        if (gamutCompress)
        {
            JMh = compressGamut(JMh, 0);
        }
    }
    else
    {
        JMh = XYZ_to_Hellwig2022_JMh(XYZ, d65White);
        if (gamutCompress)
        {
            JMh = compressGamut(JMh, 1);
        }
        if (toneCurve)
        {
            JMh = inverseTonescale(JMh, compressChroma);
        }
    }
    if (JMhOut)
    {
        out.x = JMh.x / referenceLuminance;
        out.y = JMh.y / referenceLuminance;
        out.z = JMh.z / 360.0f;
    }
    else
    {
        if (!invert)
        {
            if (!d60Sim)
            {
                XYZ = Hellwig2022_JMh_to_XYZ(JMh , d65White) / referenceLuminance;
            }
            else
            {
                XYZ = Hellwig2022_JMh_to_XYZ(JMh , inWhite) / referenceLuminance;
                float3 creativeWhiteXYZ = vector_dot(RGB_to_XYZ_P3D60, make_float3(1.0f, 1.0f, 1.0f));
                float3 creativeWhiteRGB = vector_dot(XYZ_to_RGB_output, creativeWhiteXYZ);
                XYZ *= 1.0f / max(creativeWhiteRGB.x, max(creativeWhiteRGB.y, creativeWhiteRGB.z));
            }
            out = vector_dot(XYZ_to_RGB_output, XYZ);

            // Soft clamp by compressing negative display linear values
            if (softClip)
            {
                float3 compr = make_float3(clamp_thr, clamp_dist, 1.2f);
                out = compress_aces(out, compr, compr, compr, 0);
            }

            // hard clip 0-peak
            if (hardClip)
            {
                out = clamp3(referenceLuminance * out, 0.0f, daniele_n);
            }
            else
            {
                out *= referenceLuminance;
            }
            
            if (asPQ)
            {
                out = vector_dot(P3D65_to_BT2020, out);
                out.x = linear_to_ST2084(out.x);
                out.y = linear_to_ST2084(out.y);
                out.z = linear_to_ST2084(out.z);
            }
            else
            {
                out = float3spow(out / referenceLuminance, 1.0f / 2.4f);
            }
        }
        else
        {
            XYZ = Hellwig2022_JMh_to_XYZ(JMh , inWhite) / referenceLuminance;
            out = vector_dot(XYZ_to_AP0_ACES_matrix, XYZ);
        }
    }

    return out;
}